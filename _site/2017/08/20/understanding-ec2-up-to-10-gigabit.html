<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Understanding EC2 “Up to 10 Gigabit” network performance for R4 instances | Deplication</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Understanding EC2 “Up to 10 Gigabit” network performance for R4 instances" />
<meta name="author" content="Craig Watcham" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post investigates the network performance of AWS R4 instances with a focus on the “Up to 10 Gigabit” networking expected from smaller (r4.large - r4.4xlarge) instance types. Before starting it should be noted that this post is based on observation and as such is prone to imprecision and variance, it is intended as a guide for what can be expected and not a comprehensive or scientific review. The R4 instance documentation states “The smaller R4 instance sizes offer peak throughput of 10 Gbps. These instances use a network I/O credit mechanism to allocate network bandwidth to instances based on average bandwidth utilization. These instances accrue credits when their network throughput is below their baseline limits, and can use these credits when they perform network data transfers.” This is not particularly helpful in understanding the lower bounds on network performance and gives no indication of the baseline limits with AWS recommending customers benchmark the networking performance of various instances to evaluate whether the instance type and size will meet the application network performance requirements. Logically we would expect the r4.large to have a fraction of the total 20 Gbps available on an r4.16xlarge. From the instance size normalisation table under the reserved instance modification documentation a *.large instance (factor of 4) should expect 1/32 of the resources available on a *.16xlarge instance (factor of 128) which works out at 0.625 Gbps (20 Gbps / 32) or 625 Mbps. Testing r4.large baseline network performance Using iperf3 between two newly launched Amazon Linux r4.large instances in the same availability zone in eu-west-1, we run into the first interesting anomaly with the network stream maxing out at 5 Gbps rather than the expected 10 Gbps: $ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V  iperf 3-CURRENT Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64 Control connection MSS 8949 Time: Sun, 20 Aug 2017 07:35:48 GMT Connecting to host 172.31.7.67, port 5201       Cookie: p2v6ry2kzjo2udittrzgmxotz7we3in5etmv       TCP MSS: 8949 (default) [  5] local 172.31.10.235 port 41270 connected to 172.31.7.67 port 5201 Starting Test: protocol: TCP, 1 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0 [ ID] Interval           Transfer     Bitrate         Retr  Cwnd [  5]   0.00-1.00   sec   598 MBytes  5015 Mbits/sec    9    664 KBytes        [  5]   1.00-2.00   sec   596 MBytes  4999 Mbits/sec    3    559 KBytes        [  5]   2.00-3.00   sec   595 MBytes  4992 Mbits/sec    9    586 KBytes        [  5]   3.00-4.00   sec   595 MBytes  4989 Mbits/sec    0    638 KBytes        [  5]   4.00-5.00   sec   596 MBytes  5000 Mbits/sec    0    638 KBytes        [  5]   5.00-6.00   sec   595 MBytes  4989 Mbits/sec    0    638 KBytes        [  5]   6.00-7.00   sec   595 MBytes  4990 Mbits/sec    6    638 KBytes        [  5]   7.00-8.00   sec   595 MBytes  4990 Mbits/sec    3    524 KBytes        [  5]   8.00-9.00   sec   596 MBytes  4997 Mbits/sec    0    586 KBytes        [  5]   9.00-10.00  sec   596 MBytes  4997 Mbits/sec    0    603 KBytes        [  5]  10.00-11.00  sec   595 MBytes  4990 Mbits/sec    0    638 KBytes        Interestingly, using 2 parallel streams results in us (mostly) reaching the advertised 10 Gbps: $ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V -P 2 iperf 3-CURRENT Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64 Control connection MSS 8949 Time: Sun, 20 Aug 2017 07:37:38 GMT Connecting to host 172.31.7.67, port 5201 &nbsp; &nbsp; &nbsp; Cookie: q343avscwpva5uyg2ayeinboxi5pllvw5l7r &nbsp; &nbsp; &nbsp; TCP MSS: 8949 (default) [ &nbsp;5] local 172.31.10.235 port 41274 connected to 172.31.7.67 port 5201 [ &nbsp;7] local 172.31.10.235 port 41276 connected to 172.31.7.67 port 5201 Starting Test: protocol: TCP, 2 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0 [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;5] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 597 MBytes &nbsp;5010 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9979 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4994 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4962 Mbits/sec &nbsp; 18 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9956 Mbits/sec &nbsp; 18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4957 Mbits/sec &nbsp;137 &nbsp; &nbsp;463 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 587 MBytes &nbsp;4924 Mbits/sec &nbsp; 41 &nbsp; &nbsp;725 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9881 Mbits/sec &nbsp;178 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4973 Mbits/sec &nbsp; 46 &nbsp; &nbsp;367 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4956 Mbits/sec &nbsp; 40 &nbsp; &nbsp;419 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 86 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp;141 &nbsp; &nbsp;542 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4960 Mbits/sec &nbsp; 36 &nbsp; &nbsp;559 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9928 Mbits/sec &nbsp;177 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4995 Mbits/sec &nbsp; 30 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4934 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;568 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 38 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;5000 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 589 MBytes &nbsp;4945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;629 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4935 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp;655 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 594 MBytes &nbsp;4982 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;682 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9917 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4974 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;620 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4978 Mbits/sec &nbsp; 12 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 8.00-9.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9952 Mbits/sec &nbsp; 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 596 MBytes &nbsp;4999 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 590 MBytes &nbsp;4951 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 9.00-10.00 &nbsp;sec &nbsp;1.16 GBytes &nbsp;9950 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This behaviour is not consistent, stopping and restarting the instances often resulted in the full 10 Gbps on a single stream suggesting the issue relates to instance placement, something that appears to be supported by the placement group documentation which states: &quot;Network traffic to and from resources outside the placement group is limited to 5 Gbps.&quot; It is also possible that the streams are incorrectly being treated as placement group or public internet flows with different limits. For consistency I have used two parallel streams to avoid this issue in the rest of the article. The CloudWatch graphs shows us reaching a steady baseline after around eight minutes of starting iperf3: A quick word on the graph above, firstly it is in bytes and, having&nbsp;enabled detailed monitoring,&nbsp;one minute granularity. For conversion purpose this means we need to divide the value of the metric by 60 to get bytes per second and then multiple by 8 to get bits per seconds. Looking at the actual data from the graph above: $ aws cloudwatch get-metric-statistics --metric-name NetworkOut --start-time 2017-08-20T08:23:00 --end-time 2017-08-20T08:35:00 --period 60 --namespace AWS/EC2 --statistics Average --dimensions Name=InstanceId,Value=i-0a7e009e7c0bf8fa8 &nbsp;--query &#39;Datapoints[*].[Timestamp,Average]&#39; --output=text | sort 2017-08-20T08:23:00Z 486.0 2017-08-20T08:24:00Z 5726.0 2017-08-20T08:25:00Z 22711496136.0 2017-08-20T08:26:00Z 76376122845.0 2017-08-20T08:27:00Z 76403033046.0 2017-08-20T08:28:00Z 76357957564.0 2017-08-20T08:29:00Z 76304994405.0 2017-08-20T08:30:00Z 48667898310.0 2017-08-20T08:31:00Z 5776989873.0 2017-08-20T08:32:00Z 5816890095.0 2017-08-20T08:33:00Z 5692555065.0 2017-08-20T08:34:00Z 5692014471.0 The maximum average throughput (between 08:26 and 08:29) is around 76 GByte/minute which works out at around 1.2 GByte/second or approximately 10.1 Gbit/second. Similarly the baseline (from 08:31 onwards) is in the region of 5.7 GByte/minute which translates to around 94 MByte/second or around 750 Mbit/second. These numbers are naturally averages but are fairly close to the actual iperf3 results, with the peak throughput of just over 10Gbit/second: [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;6] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5065 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5062 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10127 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5048 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5047 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10093 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5042 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10092 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 603 MBytes &nbsp;5063 Mbits/sec &nbsp; &nbsp;0 &nbsp; 1.44 MBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5041 Mbits/sec &nbsp; 66 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10104 Mbits/sec &nbsp;66 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - And the baseline of around 750Mbit/second: [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;6] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 376.00-377.00 sec &nbsp;87.5 MBytes &nbsp; 734 Mbits/sec &nbsp;314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;161 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;167 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 377.00-378.00 sec &nbsp;90.0 MBytes &nbsp; 755 Mbits/sec &nbsp;328 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 378.00-379.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;182 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 378.00-379.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;168 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 378.00-379.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;350 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 379.00-380.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;150 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 379.00-380.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;165 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 379.00-380.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;315 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 380.00-381.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;129 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 380.00-381.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;203 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 380.00-381.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;332 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 381.00-382.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;147 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 381.00-382.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;220 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 381.00-382.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;367 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 382.00-383.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;175 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 382.00-383.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;167 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 382.00-383.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;342 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 383.00-384.00 sec &nbsp;41.2 MBytes &nbsp; 346 Mbits/sec &nbsp;165 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 383.00-384.00 sec &nbsp;47.5 MBytes &nbsp; 398 Mbits/sec &nbsp;170 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 383.00-384.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;335 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 384.00-385.00 sec &nbsp;50.0 MBytes &nbsp; 419 Mbits/sec &nbsp;195 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 384.00-385.00 sec &nbsp;38.8 MBytes &nbsp; 325 Mbits/sec &nbsp;157 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 384.00-385.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;352 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - Calculating network credit rates Using the baseline for network performance we can draw some inferences about the rate at which network credits are accrued. For simplicity I am going to define a network credit as having a value of 1 Gbps, so an instance with 10 network credits could transmit at 10 Gbps for 1 second, naturally if the instance network limit is 10 Gbps the maximum rate can&#39;t be exceeded even if the instance credit balance is sufficient (20 credits allows 2 seconds at 10 Gbps rather than 1 second at 20 Gbps) . Given the base network performance in the previous section, we can assume that an r4.large has a network credit rate of around 0.75 credits per second. We can also assume a starting balance of around 2700 as we were able to maintain 10 Gbps for around 295 seconds ((10 - 0.75) * 295) at the start of the iperf3 run. Finally it appears the maximum credit balance on the r4.large is the same as the initial balance. Leaving the instances idle for 3 hours should have resulted in a credit balance of around 8100 (0.75 rate * 3600 seconds in an hour * 3 hours) which should have theoretically allowed 810 seconds at 10 Gbps but instead provided only around 295 seconds. R4 network performance table Below is a table of the expected performance for R4 instance sizes. Instance Baseline Gbps (approximate) Initial/Max Credit (approximate) Maximum time at 10Gbps (approximate seconds) r4.large 0.75 2700 295 r4.xlarge 1.25 5145 589 r4.2xlarge 2.5 8925 1191 r4.4xlarge 5 11950 2390 To calculate whether or not an instance will match your network throughput requirements take the difference from the baseline rate and your application base network utilisation and divide by the required burst rate. For example, if your application requires a baseline of 0.6 Gbps, you would accrue credits at around 0.15 per second allowing you to burst for 10 Gbps for approximately one second every 66 seconds (10 / 0.15) or for 10 seconds every 660 seconds." />
<meta property="og:description" content="This post investigates the network performance of AWS R4 instances with a focus on the “Up to 10 Gigabit” networking expected from smaller (r4.large - r4.4xlarge) instance types. Before starting it should be noted that this post is based on observation and as such is prone to imprecision and variance, it is intended as a guide for what can be expected and not a comprehensive or scientific review. The R4 instance documentation states “The smaller R4 instance sizes offer peak throughput of 10 Gbps. These instances use a network I/O credit mechanism to allocate network bandwidth to instances based on average bandwidth utilization. These instances accrue credits when their network throughput is below their baseline limits, and can use these credits when they perform network data transfers.” This is not particularly helpful in understanding the lower bounds on network performance and gives no indication of the baseline limits with AWS recommending customers benchmark the networking performance of various instances to evaluate whether the instance type and size will meet the application network performance requirements. Logically we would expect the r4.large to have a fraction of the total 20 Gbps available on an r4.16xlarge. From the instance size normalisation table under the reserved instance modification documentation a *.large instance (factor of 4) should expect 1/32 of the resources available on a *.16xlarge instance (factor of 128) which works out at 0.625 Gbps (20 Gbps / 32) or 625 Mbps. Testing r4.large baseline network performance Using iperf3 between two newly launched Amazon Linux r4.large instances in the same availability zone in eu-west-1, we run into the first interesting anomaly with the network stream maxing out at 5 Gbps rather than the expected 10 Gbps: $ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V  iperf 3-CURRENT Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64 Control connection MSS 8949 Time: Sun, 20 Aug 2017 07:35:48 GMT Connecting to host 172.31.7.67, port 5201       Cookie: p2v6ry2kzjo2udittrzgmxotz7we3in5etmv       TCP MSS: 8949 (default) [  5] local 172.31.10.235 port 41270 connected to 172.31.7.67 port 5201 Starting Test: protocol: TCP, 1 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0 [ ID] Interval           Transfer     Bitrate         Retr  Cwnd [  5]   0.00-1.00   sec   598 MBytes  5015 Mbits/sec    9    664 KBytes        [  5]   1.00-2.00   sec   596 MBytes  4999 Mbits/sec    3    559 KBytes        [  5]   2.00-3.00   sec   595 MBytes  4992 Mbits/sec    9    586 KBytes        [  5]   3.00-4.00   sec   595 MBytes  4989 Mbits/sec    0    638 KBytes        [  5]   4.00-5.00   sec   596 MBytes  5000 Mbits/sec    0    638 KBytes        [  5]   5.00-6.00   sec   595 MBytes  4989 Mbits/sec    0    638 KBytes        [  5]   6.00-7.00   sec   595 MBytes  4990 Mbits/sec    6    638 KBytes        [  5]   7.00-8.00   sec   595 MBytes  4990 Mbits/sec    3    524 KBytes        [  5]   8.00-9.00   sec   596 MBytes  4997 Mbits/sec    0    586 KBytes        [  5]   9.00-10.00  sec   596 MBytes  4997 Mbits/sec    0    603 KBytes        [  5]  10.00-11.00  sec   595 MBytes  4990 Mbits/sec    0    638 KBytes        Interestingly, using 2 parallel streams results in us (mostly) reaching the advertised 10 Gbps: $ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V -P 2 iperf 3-CURRENT Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64 Control connection MSS 8949 Time: Sun, 20 Aug 2017 07:37:38 GMT Connecting to host 172.31.7.67, port 5201 &nbsp; &nbsp; &nbsp; Cookie: q343avscwpva5uyg2ayeinboxi5pllvw5l7r &nbsp; &nbsp; &nbsp; TCP MSS: 8949 (default) [ &nbsp;5] local 172.31.10.235 port 41274 connected to 172.31.7.67 port 5201 [ &nbsp;7] local 172.31.10.235 port 41276 connected to 172.31.7.67 port 5201 Starting Test: protocol: TCP, 2 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0 [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;5] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 597 MBytes &nbsp;5010 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9979 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4994 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4962 Mbits/sec &nbsp; 18 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9956 Mbits/sec &nbsp; 18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4957 Mbits/sec &nbsp;137 &nbsp; &nbsp;463 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 587 MBytes &nbsp;4924 Mbits/sec &nbsp; 41 &nbsp; &nbsp;725 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9881 Mbits/sec &nbsp;178 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4973 Mbits/sec &nbsp; 46 &nbsp; &nbsp;367 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4956 Mbits/sec &nbsp; 40 &nbsp; &nbsp;419 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 86 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp;141 &nbsp; &nbsp;542 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4960 Mbits/sec &nbsp; 36 &nbsp; &nbsp;559 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9928 Mbits/sec &nbsp;177 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4995 Mbits/sec &nbsp; 30 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4934 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;568 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 38 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;5000 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 589 MBytes &nbsp;4945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;629 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4935 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp;655 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 594 MBytes &nbsp;4982 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;682 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9917 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4974 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;620 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4978 Mbits/sec &nbsp; 12 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 8.00-9.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9952 Mbits/sec &nbsp; 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 596 MBytes &nbsp;4999 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 590 MBytes &nbsp;4951 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 9.00-10.00 &nbsp;sec &nbsp;1.16 GBytes &nbsp;9950 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This behaviour is not consistent, stopping and restarting the instances often resulted in the full 10 Gbps on a single stream suggesting the issue relates to instance placement, something that appears to be supported by the placement group documentation which states: &quot;Network traffic to and from resources outside the placement group is limited to 5 Gbps.&quot; It is also possible that the streams are incorrectly being treated as placement group or public internet flows with different limits. For consistency I have used two parallel streams to avoid this issue in the rest of the article. The CloudWatch graphs shows us reaching a steady baseline after around eight minutes of starting iperf3: A quick word on the graph above, firstly it is in bytes and, having&nbsp;enabled detailed monitoring,&nbsp;one minute granularity. For conversion purpose this means we need to divide the value of the metric by 60 to get bytes per second and then multiple by 8 to get bits per seconds. Looking at the actual data from the graph above: $ aws cloudwatch get-metric-statistics --metric-name NetworkOut --start-time 2017-08-20T08:23:00 --end-time 2017-08-20T08:35:00 --period 60 --namespace AWS/EC2 --statistics Average --dimensions Name=InstanceId,Value=i-0a7e009e7c0bf8fa8 &nbsp;--query &#39;Datapoints[*].[Timestamp,Average]&#39; --output=text | sort 2017-08-20T08:23:00Z 486.0 2017-08-20T08:24:00Z 5726.0 2017-08-20T08:25:00Z 22711496136.0 2017-08-20T08:26:00Z 76376122845.0 2017-08-20T08:27:00Z 76403033046.0 2017-08-20T08:28:00Z 76357957564.0 2017-08-20T08:29:00Z 76304994405.0 2017-08-20T08:30:00Z 48667898310.0 2017-08-20T08:31:00Z 5776989873.0 2017-08-20T08:32:00Z 5816890095.0 2017-08-20T08:33:00Z 5692555065.0 2017-08-20T08:34:00Z 5692014471.0 The maximum average throughput (between 08:26 and 08:29) is around 76 GByte/minute which works out at around 1.2 GByte/second or approximately 10.1 Gbit/second. Similarly the baseline (from 08:31 onwards) is in the region of 5.7 GByte/minute which translates to around 94 MByte/second or around 750 Mbit/second. These numbers are naturally averages but are fairly close to the actual iperf3 results, with the peak throughput of just over 10Gbit/second: [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;6] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5065 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5062 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10127 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5048 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5047 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10093 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5042 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10092 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 603 MBytes &nbsp;5063 Mbits/sec &nbsp; &nbsp;0 &nbsp; 1.44 MBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5041 Mbits/sec &nbsp; 66 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10104 Mbits/sec &nbsp;66 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - And the baseline of around 750Mbit/second: [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;6] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 376.00-377.00 sec &nbsp;87.5 MBytes &nbsp; 734 Mbits/sec &nbsp;314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;161 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;167 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 377.00-378.00 sec &nbsp;90.0 MBytes &nbsp; 755 Mbits/sec &nbsp;328 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 378.00-379.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;182 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 378.00-379.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;168 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 378.00-379.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;350 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 379.00-380.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;150 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 379.00-380.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;165 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 379.00-380.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;315 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 380.00-381.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;129 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 380.00-381.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;203 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 380.00-381.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;332 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 381.00-382.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;147 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 381.00-382.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;220 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 381.00-382.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;367 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 382.00-383.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;175 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 382.00-383.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;167 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 382.00-383.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;342 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 383.00-384.00 sec &nbsp;41.2 MBytes &nbsp; 346 Mbits/sec &nbsp;165 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 383.00-384.00 sec &nbsp;47.5 MBytes &nbsp; 398 Mbits/sec &nbsp;170 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 383.00-384.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;335 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 384.00-385.00 sec &nbsp;50.0 MBytes &nbsp; 419 Mbits/sec &nbsp;195 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 384.00-385.00 sec &nbsp;38.8 MBytes &nbsp; 325 Mbits/sec &nbsp;157 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 384.00-385.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;352 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - Calculating network credit rates Using the baseline for network performance we can draw some inferences about the rate at which network credits are accrued. For simplicity I am going to define a network credit as having a value of 1 Gbps, so an instance with 10 network credits could transmit at 10 Gbps for 1 second, naturally if the instance network limit is 10 Gbps the maximum rate can&#39;t be exceeded even if the instance credit balance is sufficient (20 credits allows 2 seconds at 10 Gbps rather than 1 second at 20 Gbps) . Given the base network performance in the previous section, we can assume that an r4.large has a network credit rate of around 0.75 credits per second. We can also assume a starting balance of around 2700 as we were able to maintain 10 Gbps for around 295 seconds ((10 - 0.75) * 295) at the start of the iperf3 run. Finally it appears the maximum credit balance on the r4.large is the same as the initial balance. Leaving the instances idle for 3 hours should have resulted in a credit balance of around 8100 (0.75 rate * 3600 seconds in an hour * 3 hours) which should have theoretically allowed 810 seconds at 10 Gbps but instead provided only around 295 seconds. R4 network performance table Below is a table of the expected performance for R4 instance sizes. Instance Baseline Gbps (approximate) Initial/Max Credit (approximate) Maximum time at 10Gbps (approximate seconds) r4.large 0.75 2700 295 r4.xlarge 1.25 5145 589 r4.2xlarge 2.5 8925 1191 r4.4xlarge 5 11950 2390 To calculate whether or not an instance will match your network throughput requirements take the difference from the baseline rate and your application base network utilisation and divide by the required burst rate. For example, if your application requires a baseline of 0.6 Gbps, you would accrue credits at around 0.15 per second allowing you to burst for 10 Gbps for approximately one second every 66 seconds (10 / 0.15) or for 10 seconds every 660 seconds." />
<link rel="canonical" href="http://localhost:4000/2017/08/20/understanding-ec2-up-to-10-gigabit.html" />
<meta property="og:url" content="http://localhost:4000/2017/08/20/understanding-ec2-up-to-10-gigabit.html" />
<meta property="og:site_name" content="Deplication" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-08-20T15:36:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Understanding EC2 “Up to 10 Gigabit” network performance for R4 instances" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Craig Watcham"},"dateModified":"2017-08-20T15:36:00+01:00","datePublished":"2017-08-20T15:36:00+01:00","description":"This post investigates the network performance of AWS R4 instances with a focus on the “Up to 10 Gigabit” networking expected from smaller (r4.large - r4.4xlarge) instance types. Before starting it should be noted that this post is based on observation and as such is prone to imprecision and variance, it is intended as a guide for what can be expected and not a comprehensive or scientific review. The R4 instance documentation states “The smaller R4 instance sizes offer peak throughput of 10 Gbps. These instances use a network I/O credit mechanism to allocate network bandwidth to instances based on average bandwidth utilization. These instances accrue credits when their network throughput is below their baseline limits, and can use these credits when they perform network data transfers.” This is not particularly helpful in understanding the lower bounds on network performance and gives no indication of the baseline limits with AWS recommending customers benchmark the networking performance of various instances to evaluate whether the instance type and size will meet the application network performance requirements. Logically we would expect the r4.large to have a fraction of the total 20 Gbps available on an r4.16xlarge. From the instance size normalisation table under the reserved instance modification documentation a *.large instance (factor of 4) should expect 1/32 of the resources available on a *.16xlarge instance (factor of 128) which works out at 0.625 Gbps (20 Gbps / 32) or 625 Mbps. Testing r4.large baseline network performance Using iperf3 between two newly launched Amazon Linux r4.large instances in the same availability zone in eu-west-1, we run into the first interesting anomaly with the network stream maxing out at 5 Gbps rather than the expected 10 Gbps: $ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V  iperf 3-CURRENT Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64 Control connection MSS 8949 Time: Sun, 20 Aug 2017 07:35:48 GMT Connecting to host 172.31.7.67, port 5201       Cookie: p2v6ry2kzjo2udittrzgmxotz7we3in5etmv       TCP MSS: 8949 (default) [  5] local 172.31.10.235 port 41270 connected to 172.31.7.67 port 5201 Starting Test: protocol: TCP, 1 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0 [ ID] Interval           Transfer     Bitrate         Retr  Cwnd [  5]   0.00-1.00   sec   598 MBytes  5015 Mbits/sec    9    664 KBytes        [  5]   1.00-2.00   sec   596 MBytes  4999 Mbits/sec    3    559 KBytes        [  5]   2.00-3.00   sec   595 MBytes  4992 Mbits/sec    9    586 KBytes        [  5]   3.00-4.00   sec   595 MBytes  4989 Mbits/sec    0    638 KBytes        [  5]   4.00-5.00   sec   596 MBytes  5000 Mbits/sec    0    638 KBytes        [  5]   5.00-6.00   sec   595 MBytes  4989 Mbits/sec    0    638 KBytes        [  5]   6.00-7.00   sec   595 MBytes  4990 Mbits/sec    6    638 KBytes        [  5]   7.00-8.00   sec   595 MBytes  4990 Mbits/sec    3    524 KBytes        [  5]   8.00-9.00   sec   596 MBytes  4997 Mbits/sec    0    586 KBytes        [  5]   9.00-10.00  sec   596 MBytes  4997 Mbits/sec    0    603 KBytes        [  5]  10.00-11.00  sec   595 MBytes  4990 Mbits/sec    0    638 KBytes        Interestingly, using 2 parallel streams results in us (mostly) reaching the advertised 10 Gbps: $ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V -P 2 iperf 3-CURRENT Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64 Control connection MSS 8949 Time: Sun, 20 Aug 2017 07:37:38 GMT Connecting to host 172.31.7.67, port 5201 &nbsp; &nbsp; &nbsp; Cookie: q343avscwpva5uyg2ayeinboxi5pllvw5l7r &nbsp; &nbsp; &nbsp; TCP MSS: 8949 (default) [ &nbsp;5] local 172.31.10.235 port 41274 connected to 172.31.7.67 port 5201 [ &nbsp;7] local 172.31.10.235 port 41276 connected to 172.31.7.67 port 5201 Starting Test: protocol: TCP, 2 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0 [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;5] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 597 MBytes &nbsp;5010 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9979 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4994 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4962 Mbits/sec &nbsp; 18 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9956 Mbits/sec &nbsp; 18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4957 Mbits/sec &nbsp;137 &nbsp; &nbsp;463 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 587 MBytes &nbsp;4924 Mbits/sec &nbsp; 41 &nbsp; &nbsp;725 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9881 Mbits/sec &nbsp;178 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4973 Mbits/sec &nbsp; 46 &nbsp; &nbsp;367 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4956 Mbits/sec &nbsp; 40 &nbsp; &nbsp;419 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 86 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp;141 &nbsp; &nbsp;542 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4960 Mbits/sec &nbsp; 36 &nbsp; &nbsp;559 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9928 Mbits/sec &nbsp;177 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4995 Mbits/sec &nbsp; 30 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4934 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;568 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 38 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;5000 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 589 MBytes &nbsp;4945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;629 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4935 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp;655 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 594 MBytes &nbsp;4982 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;682 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9917 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4974 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;620 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4978 Mbits/sec &nbsp; 12 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 8.00-9.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9952 Mbits/sec &nbsp; 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;5] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 596 MBytes &nbsp;4999 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;7] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 590 MBytes &nbsp;4951 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 9.00-10.00 &nbsp;sec &nbsp;1.16 GBytes &nbsp;9950 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This behaviour is not consistent, stopping and restarting the instances often resulted in the full 10 Gbps on a single stream suggesting the issue relates to instance placement, something that appears to be supported by the placement group documentation which states: &quot;Network traffic to and from resources outside the placement group is limited to 5 Gbps.&quot; It is also possible that the streams are incorrectly being treated as placement group or public internet flows with different limits. For consistency I have used two parallel streams to avoid this issue in the rest of the article. The CloudWatch graphs shows us reaching a steady baseline after around eight minutes of starting iperf3: A quick word on the graph above, firstly it is in bytes and, having&nbsp;enabled detailed monitoring,&nbsp;one minute granularity. For conversion purpose this means we need to divide the value of the metric by 60 to get bytes per second and then multiple by 8 to get bits per seconds. Looking at the actual data from the graph above: $ aws cloudwatch get-metric-statistics --metric-name NetworkOut --start-time 2017-08-20T08:23:00 --end-time 2017-08-20T08:35:00 --period 60 --namespace AWS/EC2 --statistics Average --dimensions Name=InstanceId,Value=i-0a7e009e7c0bf8fa8 &nbsp;--query &#39;Datapoints[*].[Timestamp,Average]&#39; --output=text | sort 2017-08-20T08:23:00Z 486.0 2017-08-20T08:24:00Z 5726.0 2017-08-20T08:25:00Z 22711496136.0 2017-08-20T08:26:00Z 76376122845.0 2017-08-20T08:27:00Z 76403033046.0 2017-08-20T08:28:00Z 76357957564.0 2017-08-20T08:29:00Z 76304994405.0 2017-08-20T08:30:00Z 48667898310.0 2017-08-20T08:31:00Z 5776989873.0 2017-08-20T08:32:00Z 5816890095.0 2017-08-20T08:33:00Z 5692555065.0 2017-08-20T08:34:00Z 5692014471.0 The maximum average throughput (between 08:26 and 08:29) is around 76 GByte/minute which works out at around 1.2 GByte/second or approximately 10.1 Gbit/second. Similarly the baseline (from 08:31 onwards) is in the region of 5.7 GByte/minute which translates to around 94 MByte/second or around 750 Mbit/second. These numbers are naturally averages but are fairly close to the actual iperf3 results, with the peak throughput of just over 10Gbit/second: [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;6] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5065 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5062 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10127 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5048 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5047 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10093 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5042 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10092 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 603 MBytes &nbsp;5063 Mbits/sec &nbsp; &nbsp;0 &nbsp; 1.44 MBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5041 Mbits/sec &nbsp; 66 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10104 Mbits/sec &nbsp;66 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - And the baseline of around 750Mbit/second: [ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd [ &nbsp;6] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 376.00-377.00 sec &nbsp;87.5 MBytes &nbsp; 734 Mbits/sec &nbsp;314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;161 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;167 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 377.00-378.00 sec &nbsp;90.0 MBytes &nbsp; 755 Mbits/sec &nbsp;328 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 378.00-379.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;182 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 378.00-379.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;168 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 378.00-379.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;350 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 379.00-380.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;150 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 379.00-380.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;165 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 379.00-380.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;315 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 380.00-381.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;129 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 380.00-381.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;203 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 380.00-381.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;332 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 381.00-382.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;147 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 381.00-382.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;220 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 381.00-382.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;367 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 382.00-383.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;175 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 382.00-383.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;167 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 382.00-383.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;342 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 383.00-384.00 sec &nbsp;41.2 MBytes &nbsp; 346 Mbits/sec &nbsp;165 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 383.00-384.00 sec &nbsp;47.5 MBytes &nbsp; 398 Mbits/sec &nbsp;170 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 383.00-384.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;335 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - [ &nbsp;6] 384.00-385.00 sec &nbsp;50.0 MBytes &nbsp; 419 Mbits/sec &nbsp;195 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [ &nbsp;8] 384.00-385.00 sec &nbsp;38.8 MBytes &nbsp; 325 Mbits/sec &nbsp;157 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp; [SUM] 384.00-385.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;352 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - - - - - - - - - - - - - - - - - - - - - - - - - Calculating network credit rates Using the baseline for network performance we can draw some inferences about the rate at which network credits are accrued. For simplicity I am going to define a network credit as having a value of 1 Gbps, so an instance with 10 network credits could transmit at 10 Gbps for 1 second, naturally if the instance network limit is 10 Gbps the maximum rate can&#39;t be exceeded even if the instance credit balance is sufficient (20 credits allows 2 seconds at 10 Gbps rather than 1 second at 20 Gbps) . Given the base network performance in the previous section, we can assume that an r4.large has a network credit rate of around 0.75 credits per second. We can also assume a starting balance of around 2700 as we were able to maintain 10 Gbps for around 295 seconds ((10 - 0.75) * 295) at the start of the iperf3 run. Finally it appears the maximum credit balance on the r4.large is the same as the initial balance. Leaving the instances idle for 3 hours should have resulted in a credit balance of around 8100 (0.75 rate * 3600 seconds in an hour * 3 hours) which should have theoretically allowed 810 seconds at 10 Gbps but instead provided only around 295 seconds. R4 network performance table Below is a table of the expected performance for R4 instance sizes. Instance Baseline Gbps (approximate) Initial/Max Credit (approximate) Maximum time at 10Gbps (approximate seconds) r4.large 0.75 2700 295 r4.xlarge 1.25 5145 589 r4.2xlarge 2.5 8925 1191 r4.4xlarge 5 11950 2390 To calculate whether or not an instance will match your network throughput requirements take the difference from the baseline rate and your application base network utilisation and divide by the required burst rate. For example, if your application requires a baseline of 0.6 Gbps, you would accrue credits at around 0.15 per second allowing you to burst for 10 Gbps for approximately one second every 66 seconds (10 / 0.15) or for 10 seconds every 660 seconds.","headline":"Understanding EC2 “Up to 10 Gigabit” network performance for R4 instances","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/08/20/understanding-ec2-up-to-10-gigabit.html"},"url":"http://localhost:4000/2017/08/20/understanding-ec2-up-to-10-gigabit.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Deplication" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Deplication</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Understanding EC2 &quot;Up to 10 Gigabit&quot; network performance for R4 instances</h1>
    <p class="post-meta"><time class="dt-published" datetime="2017-08-20T15:36:00+01:00" itemprop="datePublished">
        Aug 20, 2017
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Craig Watcham</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <span style="background-color: white; font-size: 16px;">This post investigates the network performance of AWS R4 instances with a focus on the "Up to 10 Gigabit" networking expected from smaller (r4.large - r4.4xlarge) instance types.&nbsp;Before starting it should be noted that this post is based on observation and as such is prone to imprecision and variance, it is intended as a guide for what can be expected and not a comprehensive or scientific review.<br />
</span><br />
<span style="background-color: white; font-size: 16px;"><br /></span><span style="background-color: white; font-size: 16px;">
The R4 instance&nbsp;<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/memory-optimized-instances.html#memory-instances-hardware">documentation</a>&nbsp;states "The smaller R4 instance sizes offer peak throughput of 10 Gbps. These instances use a network I/O credit mechanism to allocate network bandwidth to instances based on average bandwidth utilization. These instances accrue credits when their network throughput is below their baseline limits, and can use these credits when they perform network data transfers." This is not particularly helpful in understanding the lower bounds on network performance and gives no indication of the baseline limits with AWS recommending customers&nbsp;<a href="https://aws.amazon.com/premiumsupport/knowledge-center/network-throughput-benchmark-linux-ec2/">benchmark</a>&nbsp;the networking performance of various instances to evaluate whether the instance type and size will meet the application network performance requirements.</span><span style="background-color: white; font-size: 16px;"><br /></span><span style="background-color: white; font-size: 16px;">
Logically we would expect the r4.large to have a fraction of the total 20 Gbps available on an r4.16xlarge. From the instance size normalisation table under the&nbsp;<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ri-modifying.html#ri-modification-instancemove">reserved instance modification documentation</a>&nbsp;a *.large instance (factor of 4) should expect 1/32 of the resources available on a *.16xlarge instance (factor of 128) which works out at 0.625 Gbps (20 Gbps / 32) or 625 Mbps.</span><br />
<br />
<h4>
<br class="Apple-interchange-newline" /><span style="background-color: white; font-size: 16px;">Testing r4.large baseline network performance</span></h4>
<div>
<span style="background-color: white; font-size: 16px;">
Using iperf3 between two newly launched Amazon Linux r4.large instances in the same availability zone in eu-west-1, we run into the first interesting anomaly with the network stream maxing out at 5 Gbps rather than the expected 10 Gbps:<br />
</span>
<br />
<span style="background-color: white; font-size: 16px;"><br /></span></div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">$ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iperf 3-CURRENT</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Control connection MSS 8949</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Time: Sun, 20 Aug 2017 07:35:48 GMT</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Connecting to host 172.31.7.67, port 5201</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; Cookie: p2v6ry2kzjo2udittrzgmxotz7we3in5etmv</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; TCP MSS: 8949 (default)</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] local 172.31.10.235 port 41270 connected to 172.31.7.67 port 5201</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Starting Test: protocol: TCP, 1 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 598 MBytes &nbsp;5015 Mbits/sec &nbsp; &nbsp;9 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;4999 Mbits/sec &nbsp; &nbsp;3 &nbsp; &nbsp;559 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4992 Mbits/sec &nbsp; &nbsp;9 &nbsp; &nbsp;586 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4989 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;5000 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4989 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4990 Mbits/sec &nbsp; &nbsp;6 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4990 Mbits/sec &nbsp; &nbsp;3 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;4997 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;586 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 596 MBytes &nbsp;4997 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;603 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp;10.00-11.00 &nbsp;sec &nbsp; 595 MBytes &nbsp;4990 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span><br />
<div>
<br /></div>
<div>
Interestingly, using 2 parallel streams results in us (mostly) reaching the advertised 10 Gbps:</div>
<div>
<br /></div>
<div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">$ iperf3 -p 5201 -c 172.31.7.67 -i 1 -t 3600 -f m -V -P 2</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">iperf 3-CURRENT</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Linux ip-172-31-10-235 4.9.32-15.41.amzn1.x86_64 #1 SMP Thu Jun 22 06:20:54 UTC 2017 x86_64</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Control connection MSS 8949</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Time: Sun, 20 Aug 2017 07:37:38 GMT</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Connecting to host 172.31.7.67, port 5201</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; Cookie: q343avscwpva5uyg2ayeinboxi5pllvw5l7r</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">&nbsp; &nbsp; &nbsp; TCP MSS: 8949 (default)</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] local 172.31.10.235 port 41274 connected to 172.31.7.67 port 5201</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] local 172.31.10.235 port 41276 connected to 172.31.7.67 port 5201</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">Starting Test: protocol: TCP, 2 streams, 131072 byte blocks, omitting 0 seconds, 3600 second test, tos 0</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 597 MBytes &nbsp;5010 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9979 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4994 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;690 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4962 Mbits/sec &nbsp; 18 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9956 Mbits/sec &nbsp; 18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4957 Mbits/sec &nbsp;137 &nbsp; &nbsp;463 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 587 MBytes &nbsp;4924 Mbits/sec &nbsp; 41 &nbsp; &nbsp;725 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9881 Mbits/sec &nbsp;178 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4973 Mbits/sec &nbsp; 46 &nbsp; &nbsp;367 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4956 Mbits/sec &nbsp; 40 &nbsp; &nbsp;419 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 86 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 592 MBytes &nbsp;4968 Mbits/sec &nbsp;141 &nbsp; &nbsp;542 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 591 MBytes &nbsp;4960 Mbits/sec &nbsp; 36 &nbsp; &nbsp;559 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9928 Mbits/sec &nbsp;177 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 595 MBytes &nbsp;4995 Mbits/sec &nbsp; 30 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4934 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;568 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9929 Mbits/sec &nbsp; 38 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 596 MBytes &nbsp;5000 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;664 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 589 MBytes &nbsp;4945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;629 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9945 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 588 MBytes &nbsp;4935 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp;655 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 594 MBytes &nbsp;4982 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;682 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.15 GBytes &nbsp;9917 Mbits/sec &nbsp; &nbsp;7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4974 Mbits/sec &nbsp; &nbsp;8 &nbsp; &nbsp;620 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 8.00-9.00 &nbsp; sec &nbsp; 593 MBytes &nbsp;4978 Mbits/sec &nbsp; 12 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 8.00-9.00 &nbsp; sec &nbsp;1.16 GBytes &nbsp;9952 Mbits/sec &nbsp; 20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;5] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 596 MBytes &nbsp;4999 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;638 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;7] &nbsp; 9.00-10.00 &nbsp;sec &nbsp; 590 MBytes &nbsp;4951 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;717 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
<div>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 9.00-10.00 &nbsp;sec &nbsp;1.16 GBytes &nbsp;9950 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></div>
</div>
<div>
<span style="font-family: inherit;"><br /></span></div>
<div>
<br />
<span style="font-family: inherit;">This behaviour is not consistent, stopping and restarting the instances often resulted in the full 10 Gbps on a single stream suggesting the issue relates to instance placement, something that appears to be supported by the <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/placement-groups.html#concepts-placement-groups">placement group documentation</a> which states: "Network traffic to and from resources outside the placement group is limited to 5 Gbps." It is also possible that the streams are incorrectly being treated as placement group or public internet flows with different limits. For consistency I have used two parallel streams to avoid this issue in the rest of the article.</span><br />
<span style="font-family: inherit;"><br /></span>
<span style="font-family: inherit;">The CloudWatch graphs shows us reaching a steady baseline after around eight minutes of starting iperf3:</span><br />
<div>
<br /></div>
<br /></div>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhZ4vNHMtQp9j2PJbEl2ZmZAtx0HheYSQJDvNv0uuxTlTEQKsL9yUmMLcCZFXmBy5Znkw4I1YchF0tqEEyFzM4jSIsW8Y5ut0za4iu26OH7TqnaBa2SVw1WwmOs4uU1QDl3bzQZoHi35sA/s1600/r4base.png" imageanchor="1"><img border="0" data-original-height="419" data-original-width="885" height="300" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhZ4vNHMtQp9j2PJbEl2ZmZAtx0HheYSQJDvNv0uuxTlTEQKsL9yUmMLcCZFXmBy5Znkw4I1YchF0tqEEyFzM4jSIsW8Y5ut0za4iu26OH7TqnaBa2SVw1WwmOs4uU1QDl3bzQZoHi35sA/s640/r4base.png" width="640" /></a></div>
<div>
<span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;"><br /></span></div>
<div>
<span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;"><br /></span></div>
<div>
<span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;">A quick word on the graph above, firstly it is in bytes and, having</span><span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;">&nbsp;enabled detailed monitoring,</span><span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;">&nbsp;one minute granularity. For conversion purpose this means we need to divide the value of the metric by 60 to get bytes per second and then multiple by 8 to get bits per seconds. Looking at the actual data from the graph above:</span><br />
<span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;"><br /></span>
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">$ aws cloudwatch get-metric-statistics --metric-name NetworkOut --start-time 2017-08-20T08:23:00 --end-time 2017-08-20T08:35:00 --period 60 --namespace AWS/EC2 --statistics Average --dimensions Name=InstanceId,Value=i-0a7e009e7c0bf8fa8 &nbsp;--query 'Datapoints[*].[Timestamp,Average]' --output=text | sort</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:23:00Z 486.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:24:00Z 5726.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:25:00Z 22711496136.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:26:00Z 76376122845.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:27:00Z 76403033046.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:28:00Z 76357957564.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:29:00Z 76304994405.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:30:00Z 48667898310.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:31:00Z 5776989873.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:32:00Z 5816890095.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:33:00Z 5692555065.0</span><br />
<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">2017-08-20T08:34:00Z 5692014471.0</span><br />
<span style="font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;;"><br /></span>
<span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;"><br /></span>
<span style="background-color: white; font-family: &quot;open sans&quot; , &quot;lucida grande&quot; , &quot;helvetica neue&quot; , &quot;arial&quot;; font-size: 16px;">The maximum average throughput (between 08:26 and 08:29) is around 76 GByte/minute which works out at around 1.2 GByte/second or approximately 10.1 Gbit/second. Similarly the baseline (from 08:31 onwards) is in the region of 5.7 GByte/minute which translates to around 94 MByte/second or around 750 Mbit/second. These numbers are naturally averages but are fairly close to the actual iperf3 results, with the peak throughput of just over 10Gbit/second:</span></div>
<div>
<span style="background-color: white;">
</span>
<br />
<div style="font-family: &quot;Open Sans&quot;, &quot;Lucida Grande&quot;, &quot;Helvetica Neue&quot;, Arial; font-size: 16px;">
<span style="background-color: white;"><br /></span></div>
<span style="background-color: white;">
</span>
<div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5065 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 0.00-1.00 &nbsp; sec &nbsp; 604 MBytes &nbsp;5062 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 0.00-1.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10127 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 1.00-2.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5048 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;551 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 1.00-2.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 2.00-3.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5047 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 2.00-3.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10093 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 3.00-4.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 3.00-4.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 4.00-5.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5045 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 4.00-5.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10094 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 5.00-6.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5042 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 5.00-6.00 &nbsp; sec &nbsp;1.17 GBytes &nbsp;10092 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5046 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 6.00-7.00 &nbsp; sec &nbsp; 602 MBytes &nbsp;5049 Mbits/sec &nbsp; &nbsp;0 &nbsp; &nbsp;577 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 6.00-7.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10095 Mbits/sec &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 603 MBytes &nbsp;5063 Mbits/sec &nbsp; &nbsp;0 &nbsp; 1.44 MBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] &nbsp; 7.00-8.00 &nbsp; sec &nbsp; 601 MBytes &nbsp;5041 Mbits/sec &nbsp; 66 &nbsp; &nbsp;524 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] &nbsp; 7.00-8.00 &nbsp; sec &nbsp;1.18 GBytes &nbsp;10104 Mbits/sec &nbsp;66 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div style="font-family: &quot;Open Sans&quot;, &quot;Lucida Grande&quot;, &quot;Helvetica Neue&quot;, Arial; font-size: 16px;">
<span style="background-color: white;"><br /></span></div>
<div style="font-family: &quot;Open Sans&quot;, &quot;Lucida Grande&quot;, &quot;Helvetica Neue&quot;, Arial; font-size: 16px;">
<span style="background-color: white;">And the baseline of around 750Mbit/second:</span></div>
<div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;"><br /></span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ ID] Interval &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Transfer &nbsp; &nbsp; Bitrate &nbsp; &nbsp; &nbsp; &nbsp; Retr &nbsp;Cwnd</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 376.00-377.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;157 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 376.00-377.00 sec &nbsp;87.5 MBytes &nbsp; 734 Mbits/sec &nbsp;314 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;161 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 377.00-378.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;167 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 377.00-378.00 sec &nbsp;90.0 MBytes &nbsp; 755 Mbits/sec &nbsp;328 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 378.00-379.00 sec &nbsp;43.8 MBytes &nbsp; 367 Mbits/sec &nbsp;182 &nbsp; 69.9 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 378.00-379.00 sec &nbsp;45.0 MBytes &nbsp; 377 Mbits/sec &nbsp;168 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 378.00-379.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;350 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 379.00-380.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;150 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 379.00-380.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;165 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 379.00-380.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;315 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 380.00-381.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;129 &nbsp; 78.7 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 380.00-381.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;203 &nbsp; &nbsp;105 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 380.00-381.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;332 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 381.00-382.00 sec &nbsp;36.2 MBytes &nbsp; 304 Mbits/sec &nbsp;147 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 381.00-382.00 sec &nbsp;52.5 MBytes &nbsp; 440 Mbits/sec &nbsp;220 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 381.00-382.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;367 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 382.00-383.00 sec &nbsp;46.2 MBytes &nbsp; 388 Mbits/sec &nbsp;175 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 382.00-383.00 sec &nbsp;42.5 MBytes &nbsp; 357 Mbits/sec &nbsp;167 &nbsp; &nbsp;114 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 382.00-383.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;342 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 383.00-384.00 sec &nbsp;41.2 MBytes &nbsp; 346 Mbits/sec &nbsp;165 &nbsp; 61.2 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 383.00-384.00 sec &nbsp;47.5 MBytes &nbsp; 398 Mbits/sec &nbsp;170 &nbsp; 96.1 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 383.00-384.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;335 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;6] 384.00-385.00 sec &nbsp;50.0 MBytes &nbsp; 419 Mbits/sec &nbsp;195 &nbsp; 87.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[ &nbsp;8] 384.00-385.00 sec &nbsp;38.8 MBytes &nbsp; 325 Mbits/sec &nbsp;157 &nbsp; 52.4 KBytes &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div>
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">[SUM] 384.00-385.00 sec &nbsp;88.8 MBytes &nbsp; 744 Mbits/sec &nbsp;352 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span></div>
<div style="font-size: 16px;">
<div style="font-family: &quot;Times New Roman&quot;; font-size: medium;">
<span style="background-color: white;"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace; font-size: x-small;">- - - - - - - - - - - - - - - - - - - - - - - - -</span></span></div>
<h4>
<span style="background-color: white;">
</span></h4>
<h4>
<span style="background-color: white;">
Calculating network credit rates</span></h4>
<div>
<span style="background-color: white;">Using the baseline for network performance we can draw some inferences about the rate at which network credits are accrued. For simplicity I am going to define a network credit as having a value of 1 Gbps, so an instance with 10 network credits could transmit at 10 Gbps for 1 second, naturally if the instance network limit is 10 Gbps the maximum rate can't be exceeded even if the instance credit balance is sufficient (20 credits allows 2 seconds at 10 Gbps rather than 1 second at 20 Gbps) . Given the base network performance in the previous section, we can assume that an r4.large has a network credit rate of around 0.75 credits per second. We can also assume a starting balance of around 2700 as we were able to maintain 10 Gbps for around 295 seconds ((10 - 0.75) * 295) at the start of the iperf3 run. Finally it appears the maximum credit balance on the r4.large is the same as the initial balance. Leaving the instances idle for 3 hours should have resulted in a credit balance of around 8100 (0.75 rate * 3600 seconds in an hour * 3 hours) which should have theoretically allowed 810 seconds at 10 Gbps but instead provided only around 295 seconds.</span></div>
<div>
<span style="background-color: white;"><br /></span></div>
<h4>
<span style="background-color: white;">
</span></h4>
<h4>
<span style="background-color: white;">
R4 network performance table</span></h4>
<div>
<span style="background-color: white;">Below is a table of the expected performance for R4 instance sizes.</span><br />
<span style="background-color: white;"><br /></span></div>
<table border="2" cellpadding="1" cellspacing="1" style="width: 100%px;">
<tbody>
<tr>
<th>Instance</th>
<th>Baseline Gbps (approximate)</th>
<th>Initial/Max Credit (approximate)</th>
<th>Maximum time<br />
at 10Gbps <br />
(approximate seconds)</th>
</tr>
<tr>
<td nowrap="">r4.large</td>
<td>0.75</td>
<td>2700</td>
<td>295</td>
</tr>
<tr>
<td nowrap="">r4.xlarge</td>
<td>1.25</td>
<td>5145</td>
<td>589</td>
</tr>
<tr>
<td nowrap="">r4.2xlarge</td>
<td>2.5</td>
<td>8925</td>
<td>1191</td>
</tr>
<tr>
<td nowrap="">r4.4xlarge</td>
<td>5</td>
<td>11950</td>
<td>2390</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<span style="background-color: white;">
<div style="font-size: 16px;">
<br />
To calculate whether or not an instance will match your network throughput requirements take the difference from the baseline rate and your application base network utilisation and divide by the required burst rate.</div>
<div style="font-size: 16px;">
<br /></div>
<div style="font-size: 16px;">
For example, if your application requires a baseline of 0.6 Gbps, you would accrue credits at around 0.15 per second allowing you to burst for 10 Gbps for approximately one second every 66 seconds (10 / 0.15) or for 10 seconds every 660 seconds.</div>
</span></div>

  </div><a class="u-url" href="/2017/08/20/understanding-ec2-up-to-10-gigabit.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
                11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
                13.806c0-1.21.983-2.195 2.194-2.195zM10.606
                16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"
              />
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">GitHub User</li>
          <li><a class="u-email" href="mailto:your-email@domain.com">your-email@domain.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Simpler is better.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
