<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Memcached item memory usage | Deplication</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Memcached item memory usage" />
<meta name="author" content="Craig Watcham" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction I was recently involved with an investigation into a Memcached cluster running on AWS ElastiCache and discovered a few interesting details about Memcached. This post looks at the memory overhead of storing items in Memcached and demonstrates the impact of disabling CAS (check and set) on memory utilisation. Background - Memcached item overhead Before getting into the details some background might be useful. Starting with the basics, how much memory does Memcached actually need to store an item? Lets spin up a cluster to check, for simplicity I am using a single m3.large ElastiCache node (running memcached 1.4.24) which according to the AWS docs&nbsp;provides around 6.2GB of memory for cache items. The easiest way to look at our new cache is by telnetting to the cluster (from within the VPC) and running commands directly. To start, what does the slab allocation look like: &gt; stats slabs &lt; STAT active_slabs 0 &lt;&nbsp;STAT total_malloced 0 &lt;&nbsp;END As expected, our empty cache has 0 active slabs and no memory allocated. Lets add a value and see how this changes things: &gt; set k 0 500 1 &gt; v &lt; STORED Above, we have set an item with a key of &#39;k&#39;, no flags, a 500 second expiry time and a 1 byte value of &#39;v&#39;. Looking at the slab stats we now see: &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:chunks_per_page 10922 &lt;&nbsp;STAT 1:total_pages 1 &lt;&nbsp;STAT 1:total_chunks 10922 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt;&nbsp;STAT 1:free_chunks_end 0 &lt;&nbsp;STAT 1:mem_requested 67 &lt;&nbsp;STAT 1:get_hits 0 &lt;&nbsp;STAT 1:cmd_set 1 &lt;&nbsp;STAT 1:delete_hits 0 &lt;&nbsp;STAT 1:incr_hits 0 &lt;&nbsp;STAT 1:decr_hits 0 &lt;&nbsp;STAT 1:cas_hits 0 &lt;&nbsp;STAT 1:cas_badval 0 &lt;&nbsp;STAT 1:touch_hits 0 &lt;&nbsp;STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048512 &lt;&nbsp;END Lots of information here but lets focus on the chunks and memory stats for the moment. We now have 1 active slab with a chunk size of 96 bytes and &nbsp;one of these chunks (used_chunks) has been used to store our item, all expected except the relatively large size of the chunk used. We can see the actual memory requested was 67 bytes which means that 65 bytes of overhead are required to store the 2 byte item. Looking into the memcached code we can see that the item struct defined in memcached.h&nbsp;requires 48 bytes plus another 8 bytes for CAS. The remaining 11 bytes consist of: The null terminated key (2 bytes, 1 byte of overhead, &quot;k\0&quot;&nbsp;in our example) The CRLF terminated data (3&nbsp;bytes, 2 bytes of overhead, &quot;v\r\n&quot; in our example) The item header which is a formatted string containing the flags, data length and terminated with CRLF (6 bytes, the minimum, in our example &quot;_0_1\r\n&quot; with underscores to make the spaces more visible) The header is created in the item_make_header function in items.c, the relevant part being: &nbsp; &nbsp; *nsuffix = (uint8_t) snprintf(suffix, 40, &quot; %d %d\r\n&quot;, flags, nbytes - 2); The header formats the flags and data length as integers in a string so this overhead will increase as the data size and flag values increase. For example, setting the flag to 10 will require an extra byte of to store the extra digit in the header: &gt; set k 10 500 1 &gt; v &lt; STORED &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt;&nbsp;STAT 1:mem_requested 68 ... &lt;&nbsp;STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048512 &lt; END So you can expect at least 65 bytes of overhead per item. Disable CAS if you don&#39;t need it CAS stands for &#39;Check And Set&#39; which the Memcached protocol docs describe as: &quot;store this data but only if no one else has updated since I last fetched it.&quot; For a fair number of Memcached use cases CAS will not be used and as a result can be disabled with no impact. You can check your cluster using the stats command and looking at the cas_* values: &gt; stats ... &lt; STAT cas_misses 0 &lt;&nbsp;STAT cas_hits 0 &lt;&nbsp;STAT cas_badval 0 ... Sounds simple enough, lets test it out. After setting cas_disabled to 1 on our cluster and rebooting for the change to take effect, we set our key again: &gt; set k 0 500 1 &gt; v &lt; STORED &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt; STAT 1:mem_requested 59 ... &lt; STAT active_slabs 1 &lt; STAT total_malloced 1048512 &lt; END Not much difference except for the requested memory reducing by 8 bytes. Disabling CAS will NOT reduce the wasted memory on its own but it will allow an item to contain an extra 8 bytes of data where previously it would have needed to use a larger chunk which might be wasting significantly more memory. Lets look at an example. Assume that you are wanting to cache an item of 32 bytes, a 16 byte key and a 16 byte value. From the background section above we know that this will take 66 bytes of overhead pushing the total item size to 98 bytes, 2 bytes more than the chunk size of the first slab (using Memcached defaults), on a CAS enabled node this shows: &gt; set 0123456789ABCDEF 0 500 16 &gt; 0123456789ABCDEF &lt;&nbsp;STORED &gt; stats slabs &lt;&nbsp;STAT 2:chunk_size 120 &lt;&nbsp;STAT 2:used_chunks 1 &lt;&nbsp;STAT 2:free_chunks 8737 &lt;&nbsp;STAT 2:mem_requested 98 ... &lt; STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048560 &lt;&nbsp;END Whereas with CAS disabled the overhead is reduced to 58 bytes, allowing the item to fit into the original slab: &gt; set 0123456789ABCDEF 0 500 16 &gt; 0123456789ABCDEF &lt; STORED &gt; stats slabs &gt; STAT 1:chunk_size 96 &gt;&nbsp;STAT 1:used_chunks 1 &gt;&nbsp;STAT 1:free_chunks 10921 &gt;&nbsp;STAT 1:mem_requested 90 ... &gt;&nbsp;STAT active_slabs 1 &gt;&nbsp;STAT total_malloced 1048512 &gt;&nbsp;END This means that with CAS enabled we are wasting 18% of the memory in each chunk of this slab (22 out of 120 bytes lost per item) compared to just 6% (6 out of 96 bytes) lost with CAS disabled. If the entire cache consisted of items this size, it would result in more than 1 GB of wasted memory compared to 372 MB wasted with CAS disabled. To put this differently, disabling CAS would allow you to store approximately 7 million additional 90 byte items resulting in better cache hit rates and lower eviction rates. This is of course an artificial example so lets look at a more realistic example where the cache item sizes are not quite so uniform. The following stats are based on a production CAS enabled node&#39;s stats adjusted by a factor of ten to fit on an m3.large (the production node had around 59 million items in slab 11 this was scaled to 5.9 million for testing). The test code used to generate this data is relatively simple and distributes the items in a slab fairly evenly across the item sizes of a slab, each item&#39;s size is slightly weighted to try and match the average item size in production. &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk SizeChunks UsedMemory AllocatedMemory RequestedAverage Item SizeMemory Wasted 4192139,81026,843,52025,706,5461841,136,974 524055,92413,421,76011,399,7762042,021,984 10752232,025174,482,800162,673,51570111,809,285 119445,985,7355,650,533,8404,643,546,6397761,006,987,201 121,18410,95112,965,98411,429,9651,0441,536,019 131,4807,17710,621,9609,421,6131,3131,200,347 141,8566,07111,267,77610,148,6641,6721,119,112 152,3205,32512,354,00011,094,2912,0831,259,709 162,9044,62113,419,38411,947,5742,5851,471,810 173,6323,69513,420,24011,906,6343,2221,513,606 184,5445,20123,633,34421,025,6094,0432,607,735 195,6804,52325,690,64023,038,0125,0942,652,628 207,1043,77826,838,91223,778,0176,2943,060,895 218,8803,02226,835,36023,630,9797,8203,204,381 2211,1042,41726,838,36823,754,9449,8283,083,424 2313,8801,93326,830,04023,092,97011,9473,737,070 2417,3521,10719,208,66415,554,07514,0513,654,589 6,473,3156,115,206,5925,063,149,8231,052,056,769 The table shows that we are caching around 6.4 million items with the majority of them falling in slabs 4, 10, and 11 and that around 1 GB of memory is being wasted. Average item size is computed from (memory requested / chunks used, rounded to the nearest byte) and is an indicator of the actual item sizes (including overhead) within each slab. An interesting point relevant to the CAS discussion is that the average item size for slab 11 is 776 bytes which is only marginally bigger than the chunk size for slab 10. Running the test code against a node with CAS disabled yields the following results: &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk SizeChunks UsedMemory AllocatedMemory RequestedAverage Item SizeMemory Wasted 4192165,99031,870,08029,471,7291782,398,351 524029,7447,138,5606,068,7212041,069,839 107523,365,9262,531,176,3522,496,542,13274234,634,220 119442,853,0792,693,306,5762,261,103,795793432,202,781 121,18410,33112,231,90410,910,8291,0561,321,075 131,4806,6039,772,4408,703,3011,3181,069,139 141,8566,11611,351,29610,202,5071,6681,148,789 152,3205,46912,688,08011,429,1952,0901,258,885 162,9044,65113,506,50412,137,6202,6101,368,884 173,6323,62913,180,52811,834,3843,2611,346,144 184,5445,08923,124,41620,661,8494,0602,462,567 195,6804,55725,883,76023,299,1945,1132,584,566 207,1043,78626,895,74423,983,9656,3352,911,779 218,8803,05627,137,28024,146,4697,9012,990,811 2211,1042,37626,383,10423,654,2359,9552,728,869 2313,8802,29731,882,36028,479,83012,3993,402,530 2417,35261610,688,8328,733,54814,1781,955,284 6,473,3155,508,217,8165,011,363,303496,854,513 As expected, the extra 8 bytes per slab has allowed a large number of items to be moved to slabs having smaller chunk sizes with more than half of the items in slab 11 now fitting into slab 10 and saving almost 600 MB of memory. The average item size being closer to the slab chunk size is another indicator that we are making more efficient use of the memory in each slab. For reference, the size of the items each slab can contain are below. The chunk sizes are displayed when running &#39;memcached -vv&#39;, reformatting this into a table and calculating the maximum item size gives: &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk sizeMax dataMin data 196301 21205431 31528655 419212587 5240173126 6304237174 7384317238 8480413318 9600533414 10752685534 11944877686 1211841116878 13148014121117 14185617881413 15232022521789 16290428362253 17363235642837 18454444763565 19568056124477 20710470365613 21888088127037 2211104110358813 23138801381111036 24173521728313812 25216962162717284 26271202705121628 27339043383527052 28423844231533836 29529845291542316 30662326616352916 31827928272366164 3210349610342682724 33129376129306103427 34161720161650129307 35202152202082161651 36252696252626202083 37315872315802252627 38394840394770315803 39493552493482394771 40616944616874493483 41771184771114616875 4210485761048505771115 This table is using the default Memcached config settings (48 min item, 1.25 growth factor, cas enabled). The &quot;Max data&quot; column is the maximum number of bytes that can be used to store both the key and the value for an item in this slab. The &quot;Min data&quot; column is the minimum data size required for an item to be put in a slab and is simply the maximum data size from the previous slab&nbsp;+ 1. With CAS disabled the max and min data values would be increased by 8 bytes for all items with the exception of the minimum data for slab 1 remaining at 1 byte. The following Python function can be used for calculating the maximum item size (key + value)&nbsp;per slab:" />
<meta property="og:description" content="Introduction I was recently involved with an investigation into a Memcached cluster running on AWS ElastiCache and discovered a few interesting details about Memcached. This post looks at the memory overhead of storing items in Memcached and demonstrates the impact of disabling CAS (check and set) on memory utilisation. Background - Memcached item overhead Before getting into the details some background might be useful. Starting with the basics, how much memory does Memcached actually need to store an item? Lets spin up a cluster to check, for simplicity I am using a single m3.large ElastiCache node (running memcached 1.4.24) which according to the AWS docs&nbsp;provides around 6.2GB of memory for cache items. The easiest way to look at our new cache is by telnetting to the cluster (from within the VPC) and running commands directly. To start, what does the slab allocation look like: &gt; stats slabs &lt; STAT active_slabs 0 &lt;&nbsp;STAT total_malloced 0 &lt;&nbsp;END As expected, our empty cache has 0 active slabs and no memory allocated. Lets add a value and see how this changes things: &gt; set k 0 500 1 &gt; v &lt; STORED Above, we have set an item with a key of &#39;k&#39;, no flags, a 500 second expiry time and a 1 byte value of &#39;v&#39;. Looking at the slab stats we now see: &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:chunks_per_page 10922 &lt;&nbsp;STAT 1:total_pages 1 &lt;&nbsp;STAT 1:total_chunks 10922 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt;&nbsp;STAT 1:free_chunks_end 0 &lt;&nbsp;STAT 1:mem_requested 67 &lt;&nbsp;STAT 1:get_hits 0 &lt;&nbsp;STAT 1:cmd_set 1 &lt;&nbsp;STAT 1:delete_hits 0 &lt;&nbsp;STAT 1:incr_hits 0 &lt;&nbsp;STAT 1:decr_hits 0 &lt;&nbsp;STAT 1:cas_hits 0 &lt;&nbsp;STAT 1:cas_badval 0 &lt;&nbsp;STAT 1:touch_hits 0 &lt;&nbsp;STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048512 &lt;&nbsp;END Lots of information here but lets focus on the chunks and memory stats for the moment. We now have 1 active slab with a chunk size of 96 bytes and &nbsp;one of these chunks (used_chunks) has been used to store our item, all expected except the relatively large size of the chunk used. We can see the actual memory requested was 67 bytes which means that 65 bytes of overhead are required to store the 2 byte item. Looking into the memcached code we can see that the item struct defined in memcached.h&nbsp;requires 48 bytes plus another 8 bytes for CAS. The remaining 11 bytes consist of: The null terminated key (2 bytes, 1 byte of overhead, &quot;k\0&quot;&nbsp;in our example) The CRLF terminated data (3&nbsp;bytes, 2 bytes of overhead, &quot;v\r\n&quot; in our example) The item header which is a formatted string containing the flags, data length and terminated with CRLF (6 bytes, the minimum, in our example &quot;_0_1\r\n&quot; with underscores to make the spaces more visible) The header is created in the item_make_header function in items.c, the relevant part being: &nbsp; &nbsp; *nsuffix = (uint8_t) snprintf(suffix, 40, &quot; %d %d\r\n&quot;, flags, nbytes - 2); The header formats the flags and data length as integers in a string so this overhead will increase as the data size and flag values increase. For example, setting the flag to 10 will require an extra byte of to store the extra digit in the header: &gt; set k 10 500 1 &gt; v &lt; STORED &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt;&nbsp;STAT 1:mem_requested 68 ... &lt;&nbsp;STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048512 &lt; END So you can expect at least 65 bytes of overhead per item. Disable CAS if you don&#39;t need it CAS stands for &#39;Check And Set&#39; which the Memcached protocol docs describe as: &quot;store this data but only if no one else has updated since I last fetched it.&quot; For a fair number of Memcached use cases CAS will not be used and as a result can be disabled with no impact. You can check your cluster using the stats command and looking at the cas_* values: &gt; stats ... &lt; STAT cas_misses 0 &lt;&nbsp;STAT cas_hits 0 &lt;&nbsp;STAT cas_badval 0 ... Sounds simple enough, lets test it out. After setting cas_disabled to 1 on our cluster and rebooting for the change to take effect, we set our key again: &gt; set k 0 500 1 &gt; v &lt; STORED &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt; STAT 1:mem_requested 59 ... &lt; STAT active_slabs 1 &lt; STAT total_malloced 1048512 &lt; END Not much difference except for the requested memory reducing by 8 bytes. Disabling CAS will NOT reduce the wasted memory on its own but it will allow an item to contain an extra 8 bytes of data where previously it would have needed to use a larger chunk which might be wasting significantly more memory. Lets look at an example. Assume that you are wanting to cache an item of 32 bytes, a 16 byte key and a 16 byte value. From the background section above we know that this will take 66 bytes of overhead pushing the total item size to 98 bytes, 2 bytes more than the chunk size of the first slab (using Memcached defaults), on a CAS enabled node this shows: &gt; set 0123456789ABCDEF 0 500 16 &gt; 0123456789ABCDEF &lt;&nbsp;STORED &gt; stats slabs &lt;&nbsp;STAT 2:chunk_size 120 &lt;&nbsp;STAT 2:used_chunks 1 &lt;&nbsp;STAT 2:free_chunks 8737 &lt;&nbsp;STAT 2:mem_requested 98 ... &lt; STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048560 &lt;&nbsp;END Whereas with CAS disabled the overhead is reduced to 58 bytes, allowing the item to fit into the original slab: &gt; set 0123456789ABCDEF 0 500 16 &gt; 0123456789ABCDEF &lt; STORED &gt; stats slabs &gt; STAT 1:chunk_size 96 &gt;&nbsp;STAT 1:used_chunks 1 &gt;&nbsp;STAT 1:free_chunks 10921 &gt;&nbsp;STAT 1:mem_requested 90 ... &gt;&nbsp;STAT active_slabs 1 &gt;&nbsp;STAT total_malloced 1048512 &gt;&nbsp;END This means that with CAS enabled we are wasting 18% of the memory in each chunk of this slab (22 out of 120 bytes lost per item) compared to just 6% (6 out of 96 bytes) lost with CAS disabled. If the entire cache consisted of items this size, it would result in more than 1 GB of wasted memory compared to 372 MB wasted with CAS disabled. To put this differently, disabling CAS would allow you to store approximately 7 million additional 90 byte items resulting in better cache hit rates and lower eviction rates. This is of course an artificial example so lets look at a more realistic example where the cache item sizes are not quite so uniform. The following stats are based on a production CAS enabled node&#39;s stats adjusted by a factor of ten to fit on an m3.large (the production node had around 59 million items in slab 11 this was scaled to 5.9 million for testing). The test code used to generate this data is relatively simple and distributes the items in a slab fairly evenly across the item sizes of a slab, each item&#39;s size is slightly weighted to try and match the average item size in production. &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk SizeChunks UsedMemory AllocatedMemory RequestedAverage Item SizeMemory Wasted 4192139,81026,843,52025,706,5461841,136,974 524055,92413,421,76011,399,7762042,021,984 10752232,025174,482,800162,673,51570111,809,285 119445,985,7355,650,533,8404,643,546,6397761,006,987,201 121,18410,95112,965,98411,429,9651,0441,536,019 131,4807,17710,621,9609,421,6131,3131,200,347 141,8566,07111,267,77610,148,6641,6721,119,112 152,3205,32512,354,00011,094,2912,0831,259,709 162,9044,62113,419,38411,947,5742,5851,471,810 173,6323,69513,420,24011,906,6343,2221,513,606 184,5445,20123,633,34421,025,6094,0432,607,735 195,6804,52325,690,64023,038,0125,0942,652,628 207,1043,77826,838,91223,778,0176,2943,060,895 218,8803,02226,835,36023,630,9797,8203,204,381 2211,1042,41726,838,36823,754,9449,8283,083,424 2313,8801,93326,830,04023,092,97011,9473,737,070 2417,3521,10719,208,66415,554,07514,0513,654,589 6,473,3156,115,206,5925,063,149,8231,052,056,769 The table shows that we are caching around 6.4 million items with the majority of them falling in slabs 4, 10, and 11 and that around 1 GB of memory is being wasted. Average item size is computed from (memory requested / chunks used, rounded to the nearest byte) and is an indicator of the actual item sizes (including overhead) within each slab. An interesting point relevant to the CAS discussion is that the average item size for slab 11 is 776 bytes which is only marginally bigger than the chunk size for slab 10. Running the test code against a node with CAS disabled yields the following results: &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk SizeChunks UsedMemory AllocatedMemory RequestedAverage Item SizeMemory Wasted 4192165,99031,870,08029,471,7291782,398,351 524029,7447,138,5606,068,7212041,069,839 107523,365,9262,531,176,3522,496,542,13274234,634,220 119442,853,0792,693,306,5762,261,103,795793432,202,781 121,18410,33112,231,90410,910,8291,0561,321,075 131,4806,6039,772,4408,703,3011,3181,069,139 141,8566,11611,351,29610,202,5071,6681,148,789 152,3205,46912,688,08011,429,1952,0901,258,885 162,9044,65113,506,50412,137,6202,6101,368,884 173,6323,62913,180,52811,834,3843,2611,346,144 184,5445,08923,124,41620,661,8494,0602,462,567 195,6804,55725,883,76023,299,1945,1132,584,566 207,1043,78626,895,74423,983,9656,3352,911,779 218,8803,05627,137,28024,146,4697,9012,990,811 2211,1042,37626,383,10423,654,2359,9552,728,869 2313,8802,29731,882,36028,479,83012,3993,402,530 2417,35261610,688,8328,733,54814,1781,955,284 6,473,3155,508,217,8165,011,363,303496,854,513 As expected, the extra 8 bytes per slab has allowed a large number of items to be moved to slabs having smaller chunk sizes with more than half of the items in slab 11 now fitting into slab 10 and saving almost 600 MB of memory. The average item size being closer to the slab chunk size is another indicator that we are making more efficient use of the memory in each slab. For reference, the size of the items each slab can contain are below. The chunk sizes are displayed when running &#39;memcached -vv&#39;, reformatting this into a table and calculating the maximum item size gives: &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk sizeMax dataMin data 196301 21205431 31528655 419212587 5240173126 6304237174 7384317238 8480413318 9600533414 10752685534 11944877686 1211841116878 13148014121117 14185617881413 15232022521789 16290428362253 17363235642837 18454444763565 19568056124477 20710470365613 21888088127037 2211104110358813 23138801381111036 24173521728313812 25216962162717284 26271202705121628 27339043383527052 28423844231533836 29529845291542316 30662326616352916 31827928272366164 3210349610342682724 33129376129306103427 34161720161650129307 35202152202082161651 36252696252626202083 37315872315802252627 38394840394770315803 39493552493482394771 40616944616874493483 41771184771114616875 4210485761048505771115 This table is using the default Memcached config settings (48 min item, 1.25 growth factor, cas enabled). The &quot;Max data&quot; column is the maximum number of bytes that can be used to store both the key and the value for an item in this slab. The &quot;Min data&quot; column is the minimum data size required for an item to be put in a slab and is simply the maximum data size from the previous slab&nbsp;+ 1. With CAS disabled the max and min data values would be increased by 8 bytes for all items with the exception of the minimum data for slab 1 remaining at 1 byte. The following Python function can be used for calculating the maximum item size (key + value)&nbsp;per slab:" />
<link rel="canonical" href="http://localhost:4000/2016/02/18/memcached-item-memory-usage.html" />
<meta property="og:url" content="http://localhost:4000/2016/02/18/memcached-item-memory-usage.html" />
<meta property="og:site_name" content="Deplication" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-18T09:03:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Memcached item memory usage" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Craig Watcham"},"dateModified":"2016-02-18T09:03:00+00:00","datePublished":"2016-02-18T09:03:00+00:00","description":"Introduction I was recently involved with an investigation into a Memcached cluster running on AWS ElastiCache and discovered a few interesting details about Memcached. This post looks at the memory overhead of storing items in Memcached and demonstrates the impact of disabling CAS (check and set) on memory utilisation. Background - Memcached item overhead Before getting into the details some background might be useful. Starting with the basics, how much memory does Memcached actually need to store an item? Lets spin up a cluster to check, for simplicity I am using a single m3.large ElastiCache node (running memcached 1.4.24) which according to the AWS docs&nbsp;provides around 6.2GB of memory for cache items. The easiest way to look at our new cache is by telnetting to the cluster (from within the VPC) and running commands directly. To start, what does the slab allocation look like: &gt; stats slabs &lt; STAT active_slabs 0 &lt;&nbsp;STAT total_malloced 0 &lt;&nbsp;END As expected, our empty cache has 0 active slabs and no memory allocated. Lets add a value and see how this changes things: &gt; set k 0 500 1 &gt; v &lt; STORED Above, we have set an item with a key of &#39;k&#39;, no flags, a 500 second expiry time and a 1 byte value of &#39;v&#39;. Looking at the slab stats we now see: &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:chunks_per_page 10922 &lt;&nbsp;STAT 1:total_pages 1 &lt;&nbsp;STAT 1:total_chunks 10922 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt;&nbsp;STAT 1:free_chunks_end 0 &lt;&nbsp;STAT 1:mem_requested 67 &lt;&nbsp;STAT 1:get_hits 0 &lt;&nbsp;STAT 1:cmd_set 1 &lt;&nbsp;STAT 1:delete_hits 0 &lt;&nbsp;STAT 1:incr_hits 0 &lt;&nbsp;STAT 1:decr_hits 0 &lt;&nbsp;STAT 1:cas_hits 0 &lt;&nbsp;STAT 1:cas_badval 0 &lt;&nbsp;STAT 1:touch_hits 0 &lt;&nbsp;STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048512 &lt;&nbsp;END Lots of information here but lets focus on the chunks and memory stats for the moment. We now have 1 active slab with a chunk size of 96 bytes and &nbsp;one of these chunks (used_chunks) has been used to store our item, all expected except the relatively large size of the chunk used. We can see the actual memory requested was 67 bytes which means that 65 bytes of overhead are required to store the 2 byte item. Looking into the memcached code we can see that the item struct defined in memcached.h&nbsp;requires 48 bytes plus another 8 bytes for CAS. The remaining 11 bytes consist of: The null terminated key (2 bytes, 1 byte of overhead, &quot;k\\0&quot;&nbsp;in our example) The CRLF terminated data (3&nbsp;bytes, 2 bytes of overhead, &quot;v\\r\\n&quot; in our example) The item header which is a formatted string containing the flags, data length and terminated with CRLF (6 bytes, the minimum, in our example &quot;_0_1\\r\\n&quot; with underscores to make the spaces more visible) The header is created in the item_make_header function in items.c, the relevant part being: &nbsp; &nbsp; *nsuffix = (uint8_t) snprintf(suffix, 40, &quot; %d %d\\r\\n&quot;, flags, nbytes - 2); The header formats the flags and data length as integers in a string so this overhead will increase as the data size and flag values increase. For example, setting the flag to 10 will require an extra byte of to store the extra digit in the header: &gt; set k 10 500 1 &gt; v &lt; STORED &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt;&nbsp;STAT 1:mem_requested 68 ... &lt;&nbsp;STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048512 &lt; END So you can expect at least 65 bytes of overhead per item. Disable CAS if you don&#39;t need it CAS stands for &#39;Check And Set&#39; which the Memcached protocol docs describe as: &quot;store this data but only if no one else has updated since I last fetched it.&quot; For a fair number of Memcached use cases CAS will not be used and as a result can be disabled with no impact. You can check your cluster using the stats command and looking at the cas_* values: &gt; stats ... &lt; STAT cas_misses 0 &lt;&nbsp;STAT cas_hits 0 &lt;&nbsp;STAT cas_badval 0 ... Sounds simple enough, lets test it out. After setting cas_disabled to 1 on our cluster and rebooting for the change to take effect, we set our key again: &gt; set k 0 500 1 &gt; v &lt; STORED &gt; stats slabs &lt;&nbsp;STAT 1:chunk_size 96 &lt;&nbsp;STAT 1:used_chunks 1 &lt;&nbsp;STAT 1:free_chunks 10921 &lt; STAT 1:mem_requested 59 ... &lt; STAT active_slabs 1 &lt; STAT total_malloced 1048512 &lt; END Not much difference except for the requested memory reducing by 8 bytes. Disabling CAS will NOT reduce the wasted memory on its own but it will allow an item to contain an extra 8 bytes of data where previously it would have needed to use a larger chunk which might be wasting significantly more memory. Lets look at an example. Assume that you are wanting to cache an item of 32 bytes, a 16 byte key and a 16 byte value. From the background section above we know that this will take 66 bytes of overhead pushing the total item size to 98 bytes, 2 bytes more than the chunk size of the first slab (using Memcached defaults), on a CAS enabled node this shows: &gt; set 0123456789ABCDEF 0 500 16 &gt; 0123456789ABCDEF &lt;&nbsp;STORED &gt; stats slabs &lt;&nbsp;STAT 2:chunk_size 120 &lt;&nbsp;STAT 2:used_chunks 1 &lt;&nbsp;STAT 2:free_chunks 8737 &lt;&nbsp;STAT 2:mem_requested 98 ... &lt; STAT active_slabs 1 &lt;&nbsp;STAT total_malloced 1048560 &lt;&nbsp;END Whereas with CAS disabled the overhead is reduced to 58 bytes, allowing the item to fit into the original slab: &gt; set 0123456789ABCDEF 0 500 16 &gt; 0123456789ABCDEF &lt; STORED &gt; stats slabs &gt; STAT 1:chunk_size 96 &gt;&nbsp;STAT 1:used_chunks 1 &gt;&nbsp;STAT 1:free_chunks 10921 &gt;&nbsp;STAT 1:mem_requested 90 ... &gt;&nbsp;STAT active_slabs 1 &gt;&nbsp;STAT total_malloced 1048512 &gt;&nbsp;END This means that with CAS enabled we are wasting 18% of the memory in each chunk of this slab (22 out of 120 bytes lost per item) compared to just 6% (6 out of 96 bytes) lost with CAS disabled. If the entire cache consisted of items this size, it would result in more than 1 GB of wasted memory compared to 372 MB wasted with CAS disabled. To put this differently, disabling CAS would allow you to store approximately 7 million additional 90 byte items resulting in better cache hit rates and lower eviction rates. This is of course an artificial example so lets look at a more realistic example where the cache item sizes are not quite so uniform. The following stats are based on a production CAS enabled node&#39;s stats adjusted by a factor of ten to fit on an m3.large (the production node had around 59 million items in slab 11 this was scaled to 5.9 million for testing). The test code used to generate this data is relatively simple and distributes the items in a slab fairly evenly across the item sizes of a slab, each item&#39;s size is slightly weighted to try and match the average item size in production. &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk SizeChunks UsedMemory AllocatedMemory RequestedAverage Item SizeMemory Wasted 4192139,81026,843,52025,706,5461841,136,974 524055,92413,421,76011,399,7762042,021,984 10752232,025174,482,800162,673,51570111,809,285 119445,985,7355,650,533,8404,643,546,6397761,006,987,201 121,18410,95112,965,98411,429,9651,0441,536,019 131,4807,17710,621,9609,421,6131,3131,200,347 141,8566,07111,267,77610,148,6641,6721,119,112 152,3205,32512,354,00011,094,2912,0831,259,709 162,9044,62113,419,38411,947,5742,5851,471,810 173,6323,69513,420,24011,906,6343,2221,513,606 184,5445,20123,633,34421,025,6094,0432,607,735 195,6804,52325,690,64023,038,0125,0942,652,628 207,1043,77826,838,91223,778,0176,2943,060,895 218,8803,02226,835,36023,630,9797,8203,204,381 2211,1042,41726,838,36823,754,9449,8283,083,424 2313,8801,93326,830,04023,092,97011,9473,737,070 2417,3521,10719,208,66415,554,07514,0513,654,589 6,473,3156,115,206,5925,063,149,8231,052,056,769 The table shows that we are caching around 6.4 million items with the majority of them falling in slabs 4, 10, and 11 and that around 1 GB of memory is being wasted. Average item size is computed from (memory requested / chunks used, rounded to the nearest byte) and is an indicator of the actual item sizes (including overhead) within each slab. An interesting point relevant to the CAS discussion is that the average item size for slab 11 is 776 bytes which is only marginally bigger than the chunk size for slab 10. Running the test code against a node with CAS disabled yields the following results: &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk SizeChunks UsedMemory AllocatedMemory RequestedAverage Item SizeMemory Wasted 4192165,99031,870,08029,471,7291782,398,351 524029,7447,138,5606,068,7212041,069,839 107523,365,9262,531,176,3522,496,542,13274234,634,220 119442,853,0792,693,306,5762,261,103,795793432,202,781 121,18410,33112,231,90410,910,8291,0561,321,075 131,4806,6039,772,4408,703,3011,3181,069,139 141,8566,11611,351,29610,202,5071,6681,148,789 152,3205,46912,688,08011,429,1952,0901,258,885 162,9044,65113,506,50412,137,6202,6101,368,884 173,6323,62913,180,52811,834,3843,2611,346,144 184,5445,08923,124,41620,661,8494,0602,462,567 195,6804,55725,883,76023,299,1945,1132,584,566 207,1043,78626,895,74423,983,9656,3352,911,779 218,8803,05627,137,28024,146,4697,9012,990,811 2211,1042,37626,383,10423,654,2359,9552,728,869 2313,8802,29731,882,36028,479,83012,3993,402,530 2417,35261610,688,8328,733,54814,1781,955,284 6,473,3155,508,217,8165,011,363,303496,854,513 As expected, the extra 8 bytes per slab has allowed a large number of items to be moved to slabs having smaller chunk sizes with more than half of the items in slab 11 now fitting into slab 10 and saving almost 600 MB of memory. The average item size being closer to the slab chunk size is another indicator that we are making more efficient use of the memory in each slab. For reference, the size of the items each slab can contain are below. The chunk sizes are displayed when running &#39;memcached -vv&#39;, reformatting this into a table and calculating the maximum item size gives: &lt;/col&gt;&lt;/col&gt;&lt;/col&gt;&lt;/col&gt; SlabChunk sizeMax dataMin data 196301 21205431 31528655 419212587 5240173126 6304237174 7384317238 8480413318 9600533414 10752685534 11944877686 1211841116878 13148014121117 14185617881413 15232022521789 16290428362253 17363235642837 18454444763565 19568056124477 20710470365613 21888088127037 2211104110358813 23138801381111036 24173521728313812 25216962162717284 26271202705121628 27339043383527052 28423844231533836 29529845291542316 30662326616352916 31827928272366164 3210349610342682724 33129376129306103427 34161720161650129307 35202152202082161651 36252696252626202083 37315872315802252627 38394840394770315803 39493552493482394771 40616944616874493483 41771184771114616875 4210485761048505771115 This table is using the default Memcached config settings (48 min item, 1.25 growth factor, cas enabled). The &quot;Max data&quot; column is the maximum number of bytes that can be used to store both the key and the value for an item in this slab. The &quot;Min data&quot; column is the minimum data size required for an item to be put in a slab and is simply the maximum data size from the previous slab&nbsp;+ 1. With CAS disabled the max and min data values would be increased by 8 bytes for all items with the exception of the minimum data for slab 1 remaining at 1 byte. The following Python function can be used for calculating the maximum item size (key + value)&nbsp;per slab:","headline":"Memcached item memory usage","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2016/02/18/memcached-item-memory-usage.html"},"url":"http://localhost:4000/2016/02/18/memcached-item-memory-usage.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Deplication" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Deplication</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Memcached item memory usage</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2016-02-18T09:03:00+00:00" itemprop="datePublished">Feb 18, 2016
      </time>â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Craig Watcham</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h4>
Introduction</h4>
I was recently involved with an investigation into a Memcached cluster running on AWS ElastiCache and discovered a few interesting details about Memcached. This post looks at the memory overhead of storing items in Memcached and demonstrates the impact of disabling CAS (check and set) on memory utilisation.<br />
<ol>
</ol>
<h4>
Background - Memcached item overhead</h4>
<div>
Before getting into the details some background might be useful. Starting with the basics, how much memory does Memcached actually need to store an item? Lets spin up a cluster to check, for simplicity I am using a single m3.large ElastiCache node (running memcached 1.4.24) which according to the <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/ParameterGroups.Memcached.html#ParameterGroups.Memcached.NodeSpecific">AWS docs</a>&nbsp;provides around 6.2GB of memory for cache items.</div>
<div>
<br /></div>
<div>
The easiest way to look at our new cache is by telnetting to the cluster (from within the VPC) and running commands directly. To start, what does the slab allocation look like:</div>
<div>
<br /></div>
<div>
&gt; stats slabs</div>
<div>
<div>
&lt; STAT active_slabs 0</div>
<div>
&lt;&nbsp;STAT total_malloced 0</div>
<div>
&lt;&nbsp;END</div>
</div>
<div>
<br /></div>
<div>
As expected, our empty cache has 0 active slabs and no memory allocated. Lets add a value and see how this changes things:</div>
<div>
<br /></div>
<div>
<div>
&gt; set k 0 500 1</div>
<div>
&gt; v</div>
<div>
&lt; STORED</div>
</div>
<div>
<br /></div>
<div>
Above, we have set an item with a key of 'k', no flags, a 500 second expiry time and a 1 byte value of 'v'. Looking at the slab stats we now see:</div>
<div>
<br /></div>
<div>
<div>
&gt; stats slabs</div>
<div>
&lt;&nbsp;STAT 1:chunk_size 96</div>
<div>
&lt;&nbsp;STAT 1:chunks_per_page 10922</div>
<div>
&lt;&nbsp;STAT 1:total_pages 1</div>
<div>
&lt;&nbsp;STAT 1:total_chunks 10922</div>
<div>
&lt;&nbsp;STAT 1:used_chunks 1</div>
<div>
&lt;&nbsp;STAT 1:free_chunks 10921</div>
<div>
&lt;&nbsp;STAT 1:free_chunks_end 0</div>
<div>
&lt;&nbsp;STAT 1:mem_requested 67</div>
<div>
&lt;&nbsp;STAT 1:get_hits 0</div>
<div>
&lt;&nbsp;STAT 1:cmd_set 1</div>
<div>
&lt;&nbsp;STAT 1:delete_hits 0</div>
<div>
&lt;&nbsp;STAT 1:incr_hits 0</div>
<div>
&lt;&nbsp;STAT 1:decr_hits 0</div>
<div>
&lt;&nbsp;STAT 1:cas_hits 0</div>
<div>
&lt;&nbsp;STAT 1:cas_badval 0</div>
<div>
&lt;&nbsp;STAT 1:touch_hits 0</div>
<div>
&lt;&nbsp;STAT active_slabs 1</div>
<div>
&lt;&nbsp;STAT total_malloced 1048512</div>
<div>
&lt;&nbsp;END</div>
</div>
<div>
<br /></div>
<div>
Lots of information here but lets focus on the chunks and memory stats for the moment. We now have 1 active slab with a chunk size of 96 bytes and &nbsp;one of these chunks (used_chunks) has been used to store our item, all expected except the relatively large size of the chunk used. We can see the actual memory requested was 67 bytes which means that 65 bytes of overhead are required to store the 2 byte item. Looking into the memcached code we can see that the item struct defined in <a href="https://github.com/memcached/memcached/blob/1.4.24/memcached.h">memcached.h</a>&nbsp;requires 48 bytes plus another 8 bytes for CAS. The remaining 11 bytes consist of:</div>
<div>
<ul>
<li>The null terminated key (2 bytes, 1 byte of overhead, "k\0"&nbsp;in our example)</li>
<li>The CRLF terminated data (3&nbsp;bytes, 2 bytes of overhead, "v\r\n" in our example)</li>
<li>The item header which is a formatted string containing the flags, data length and terminated with CRLF (6 bytes, the minimum, in our example "_0_1\r\n" with underscores to make the spaces more visible)</li>
</ul>
<div>
The header is created in the item_make_header function in <a href="https://github.com/memcached/memcached/blob/1.4.24/items.c">items.c</a>, the relevant part being:</div>
</div>
<div>
<br /></div>
<div>
<div>
&nbsp; &nbsp; *nsuffix = (uint8_t) snprintf(suffix, 40, " %d %d\r\n", flags, nbytes - 2);</div>
<div>
<br /></div>
</div>
<div>
The header formats the flags and data length as integers in a string so this overhead will increase as the data size and flag values increase. For example, setting the flag to 10 will require an extra byte of to store the extra digit in the header:</div>
<div>
<br /></div>
<div>
<div>
&gt; set k 10 500 1</div>
<div>
&gt; v</div>
<div>
&lt; STORED</div>
<div>
&gt; stats slabs</div>
<div>
&lt;&nbsp;STAT 1:chunk_size 96</div>
<div>
&lt;&nbsp;STAT 1:used_chunks 1</div>
<div>
&lt;&nbsp;STAT 1:free_chunks 10921</div>
<div>
&lt;&nbsp;STAT 1:mem_requested 68</div>
<div>
...</div>
<div>
&lt;&nbsp;STAT active_slabs 1</div>
<div>
&lt;&nbsp;STAT total_malloced 1048512</div>
<div>
&lt; END</div>
</div>
<div>
<br /></div>
<div>
So you can expect at least 65 bytes of overhead per item.</div>
<div>
<br /></div>
<h4>
Disable CAS if you don't need it</h4>
<div>
CAS stands for 'Check And Set' which the Memcached <a href="https://github.com/memcached/memcached/blob/1.4.24/doc/protocol.txt">protocol docs</a> describe as: "store this data but only if no one else has updated since I last fetched it."</div>
<div>
<br /></div>
<div>
For a fair number of Memcached use cases CAS will not be used and as a result can be disabled with no impact. You can check your cluster using the stats command and looking at the cas_* values:</div>
<div>
<br /></div>
<div>
&gt; stats</div>
<div>
...</div>
<div>
<div>
&lt; STAT cas_misses 0</div>
<div>
&lt;&nbsp;STAT cas_hits 0</div>
<div>
&lt;&nbsp;STAT cas_badval 0</div>
</div>
<div>
...</div>
<div>
<br /></div>
<div>
Sounds simple enough, lets test it out. After setting cas_disabled to 1 on our cluster and rebooting for the change to take effect, we set our key again:</div>
<div>
<br /></div>
<div>
<div>
&gt; set k 0 500 1</div>
<div>
&gt; v</div>
<div>
&lt; STORED</div>
</div>
<div>
<div>
&gt; stats slabs</div>
<div>
&lt;&nbsp;STAT 1:chunk_size 96</div>
<div>
&lt;&nbsp;STAT 1:used_chunks 1</div>
<div>
&lt;&nbsp;STAT 1:free_chunks 10921</div>
</div>
<div>
<div>
&lt; STAT 1:mem_requested 59</div>
<div>
...</div>
<div>
&lt; STAT active_slabs 1</div>
<div>
&lt; STAT total_malloced 1048512</div>
<div>
&lt; END</div>
</div>
<div>
<br /></div>
<div>
Not much difference except for the requested memory reducing by 8 bytes. Disabling CAS will NOT reduce the wasted memory on its own but it will allow an item to contain an extra 8 bytes of data where previously it would have needed to use a larger chunk which might be wasting significantly more memory. Lets look at an example.</div>
<div>
<br /></div>
<div>
Assume that you are wanting to cache an item of 32 bytes, a 16 byte key and a 16 byte value. From the background section above we know that this will take 66 bytes of overhead pushing the total item size to 98 bytes, 2 bytes more than the chunk size of the first slab (using Memcached defaults), on a CAS enabled node this shows:</div>
<div>
<br /></div>
<div>
<div>
&gt; set 0123456789ABCDEF 0 500 16</div>
<div>
&gt; 0123456789ABCDEF</div>
<div>
&lt;&nbsp;STORED</div>
<div>
&gt; stats slabs</div>
<div>
&lt;&nbsp;STAT 2:chunk_size 120</div>
<div>
&lt;&nbsp;STAT 2:used_chunks 1</div>
<div>
&lt;&nbsp;STAT 2:free_chunks 8737</div>
<div>
&lt;&nbsp;STAT 2:mem_requested 98</div>
<div>
...</div>
<div>
&lt; STAT active_slabs 1</div>
<div>
&lt;&nbsp;STAT total_malloced 1048560</div>
<div>
&lt;&nbsp;END</div>
</div>
<div>
<br /></div>
<div>
Whereas with CAS disabled the overhead is reduced to 58 bytes, allowing the item to fit into the original slab:</div>
<div>
<br /></div>
<div>
<div>
&gt; set 0123456789ABCDEF 0 500 16</div>
<div>
&gt; 0123456789ABCDEF</div>
<div>
&lt; STORED</div>
<div>
&gt; stats slabs</div>
<div>
&gt; STAT 1:chunk_size 96</div>
<div>
&gt;&nbsp;STAT 1:used_chunks 1</div>
<div>
&gt;&nbsp;STAT 1:free_chunks 10921</div>
<div>
&gt;&nbsp;STAT 1:mem_requested 90</div>
<div>
...</div>
<div>
&gt;&nbsp;STAT active_slabs 1</div>
<div>
&gt;&nbsp;STAT total_malloced 1048512</div>
<div>
&gt;&nbsp;END</div>
</div>
<div>
<br /></div>
<div>
This means that with CAS enabled we are wasting 18% of the memory in each chunk of this slab (22 out of 120 bytes lost per item) compared to just 6% (6 out of 96 bytes) lost with CAS disabled. If the entire cache consisted of items this size, it would result in more than 1 GB of wasted memory compared to 372 MB wasted with CAS disabled. To put this differently, disabling CAS would allow you to store approximately 7 million additional 90 byte items resulting in better cache hit rates and lower eviction rates. This is of course an artificial example so lets look at a more realistic example where the cache item sizes are not quite so uniform.<br />
<br />
The following stats are based on a production CAS enabled node's stats adjusted by a factor of ten to fit on an m3.large (the production node had around 59 million items in slab 11 this was scaled to 5.9 million for testing). The test code used to generate this data is relatively simple and distributes the items in a slab fairly evenly across the item sizes of a slab, each item's size is slightly weighted to try and match the average item size in production.<br />
<br />
<table border="1" cellpadding="0" cellspacing="0" dir="ltr" style="border-collapse: collapse; border: 1px solid #ccc; font-family: Calibri; font-size: 13px; table-layout: fixed;"><colgroup><col width="31"></col><col width="57"></col><col width="68"></col><col width="96"></col><col width="97"></col><col width="63"></col><col width="96"></col></colgroup><tbody>
<tr style="height: 20px;"><td data-sheets-value="[null,2,&quot;Slab&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Slab</td><td data-sheets-value="[null,2,&quot;Chunk Size&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Chunk Size</td><td data-sheets-value="[null,2,&quot;Chunks Used&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Chunks Used</td><td data-sheets-value="[null,2,&quot;Memory Allocated&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Memory Allocated</td><td data-sheets-value="[null,2,&quot;Memory Requested&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Memory Requested</td><td data-sheets-value="[null,2,&quot;Average Item Size&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Average Item Size</td><td data-sheets-value="[null,2,&quot;Memory Wasted&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Memory Wasted</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,4]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4</td><td data-sheets-value="[null,3,null,192]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">192</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,139810]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">139,810</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26843520]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">26,843,520</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,25706546]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">25,706,546</td><td data-sheets-value="[null,3,null,184]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">184</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1136974]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,136,974</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,5]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5</td><td data-sheets-value="[null,3,null,240]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">240</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,55924]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">55,924</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13421760]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13,421,760</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11399776]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,399,776</td><td data-sheets-value="[null,3,null,204]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">204</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2021984]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,021,984</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,10]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">10</td><td data-sheets-value="[null,3,null,752]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">752</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,232025]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">232,025</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,174482800]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">174,482,800</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,162673515]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">162,673,515</td><td data-sheets-value="[null,3,null,701]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">701</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11809285]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,809,285</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,11]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11</td><td data-sheets-value="[null,3,null,944]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">944</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5985735]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,985,735</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5650533840]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,650,533,840</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4643546639]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4,643,546,639</td><td data-sheets-value="[null,3,null,776]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">776</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1006987201]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,006,987,201</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,12]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">12</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1184]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,184</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10951]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">10,951</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,12965984]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">12,965,984</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11429965]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,429,965</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1044]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,044</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1536019]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,536,019</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,13]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1480]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,480</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,7177]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7,177</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10621960]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">10,621,960</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,9421613]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">9,421,613</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1313]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,313</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1200347]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,200,347</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,14]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">14</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1856]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,856</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6071]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">6,071</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11267776]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,267,776</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10148664]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">10,148,664</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1672]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,672</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1119112]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,119,112</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,15]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">15</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2320]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,320</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5325]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,325</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,12354000]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">12,354,000</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11094291]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,094,291</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2083]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,083</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1259709]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,259,709</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,16]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">16</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2904]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,904</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4621]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4,621</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13419384]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13,419,384</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11947574]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,947,574</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2585]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,585</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1471810]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,471,810</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,17]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">17</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3632]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,632</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3695]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,695</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13420240]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13,420,240</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11906634]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,906,634</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3222]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,222</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1513606]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,513,606</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,18]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">18</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4544]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4,544</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5201]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,201</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23633344]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23,633,344</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,21025609]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">21,025,609</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4043]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4,043</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2607735]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,607,735</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,19]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">19</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5680]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,680</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4523]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4,523</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,25690640]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">25,690,640</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23038012]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23,038,012</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5094]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,094</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2652628]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,652,628</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,20]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">20</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,7104]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7,104</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3778]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,778</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26838912]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">26,838,912</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23778017]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23,778,017</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6294]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">6,294</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3060895]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,060,895</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,21]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">21</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,8880]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">8,880</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3022]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,022</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26835360]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">26,835,360</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23630979]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23,630,979</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,7820]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7,820</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3204381]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,204,381</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,22]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">22</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11104]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,104</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2417]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2,417</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26838368]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">26,838,368</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23754944]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23,754,944</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,9828]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">9,828</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3083424]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,083,424</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,23]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13880]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13,880</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1933]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,933</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26830040]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">26,830,040</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23092970]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23,092,970</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11947]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11,947</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3737070]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,737,070</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,24]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">24</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,17352]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">17,352</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1107]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,107</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,19208664]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">19,208,664</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,15554075]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">15,554,075</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,14051]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">14,051</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3654589]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3,654,589</td></tr>
<tr style="height: 20px;"><td style="padding: 0px 3px 0px 3px; vertical-align: bottom;"></td><td style="padding: 0px 3px 0px 3px; vertical-align: bottom;"></td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6473315]" style="font-weight: bold; padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">6,473,315</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6115206592]" style="font-weight: bold; padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">6,115,206,592</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5063149823]" style="font-weight: bold; padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5,063,149,823</td><td style="padding: 0px 3px 0px 3px; vertical-align: bottom;"></td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1052056769]" style="font-weight: bold; padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1,052,056,769</td></tr>
</tbody></table>
</div>
<div>
<br />
The table shows that we are caching around 6.4 million items with the majority of them falling in slabs 4, 10, and 11 and that around 1 GB of memory is being wasted. Average item size is computed from (memory requested / chunks used, rounded to the nearest byte) and is an indicator of the actual item sizes (including overhead) within each slab. An interesting point relevant to the CAS discussion is that the average item size for slab 11 is 776 bytes which is only marginally bigger than the chunk size for slab 10.<br />
<br />
Running the test code against a node with CAS disabled yields the following results:<br />
<br />
<table border="1" cellpadding="0" cellspacing="0" dir="ltr" style="border-collapse: collapse; border: 1px solid rgb(204, 204, 204); font-family: Calibri; font-size: 13px; table-layout: fixed;"><colgroup><col width="31"></col><col width="54"></col><col width="71"></col><col width="93"></col><col width="92"></col><col width="64"></col><col width="82"></col></colgroup><tbody>
<tr style="height: 20px;"><td data-sheets-value="[null,2,&quot;Slab&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Slab</td><td data-sheets-value="[null,2,&quot;Chunk Size&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Chunk Size</td><td data-sheets-value="[null,2,&quot;Chunks Used&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Chunks Used</td><td data-sheets-value="[null,2,&quot;Memory Allocated&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Memory Allocated</td><td data-sheets-value="[null,2,&quot;Memory Requested&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Memory Requested</td><td data-sheets-value="[null,2,&quot;Average Item Size&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Average Item Size</td><td data-sheets-value="[null,2,&quot;Memory Wasted&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom; word-wrap: break-word;">Memory Wasted</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,4]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">4</td><td data-sheets-value="[null,3,null,192]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">192</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,165990]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">165,990</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,31870080]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">31,870,080</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,29471729]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">29,471,729</td><td data-sheets-value="[null,3,null,178]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">178</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2398351]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,398,351</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,5]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">5</td><td data-sheets-value="[null,3,null,240]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">240</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,29744]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">29,744</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,7138560]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">7,138,560</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6068721]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">6,068,721</td><td data-sheets-value="[null,3,null,204]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">204</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1069839]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,069,839</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,10]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">10</td><td data-sheets-value="[null,3,null,752]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">752</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3365926]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,365,926</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2531176352]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,531,176,352</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2496542132]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,496,542,132</td><td data-sheets-value="[null,3,null,742]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">742</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,34634220]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">34,634,220</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,11]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">11</td><td data-sheets-value="[null,3,null,944]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">944</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2853079]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,853,079</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2693306576]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,693,306,576</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2261103795]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,261,103,795</td><td data-sheets-value="[null,3,null,793]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">793</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,432202781]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">432,202,781</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,12]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">12</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1184]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,184</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10331]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">10,331</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,12231904]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">12,231,904</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10910829]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">10,910,829</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1056]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,056</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1321075]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,321,075</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,13]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">13</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1480]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,480</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6603]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">6,603</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,9772440]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">9,772,440</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,8703301]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">8,703,301</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1318]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,318</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1069139]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,069,139</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,14]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">14</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1856]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,856</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6116]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">6,116</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11351296]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">11,351,296</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10202507]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">10,202,507</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1668]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,668</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1148789]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,148,789</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,15]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">15</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2320]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,320</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5469]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">5,469</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,12688080]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">12,688,080</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11429195]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">11,429,195</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2090]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,090</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1258885]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,258,885</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,16]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">16</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2904]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,904</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4651]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">4,651</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13506504]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">13,506,504</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,12137620]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">12,137,620</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2610]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,610</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1368884]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,368,884</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,17]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">17</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3632]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,632</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3629]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,629</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13180528]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">13,180,528</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11834384]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">11,834,384</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3261]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,261</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1346144]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,346,144</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,18]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">18</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4544]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">4,544</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5089]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">5,089</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23124416]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">23,124,416</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,20661849]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">20,661,849</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4060]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">4,060</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2462567]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,462,567</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,19]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">19</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5680]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">5,680</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,4557]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">4,557</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,25883760]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">25,883,760</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23299194]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">23,299,194</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5113]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">5,113</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2584566]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,584,566</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,20]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">20</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,7104]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">7,104</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3786]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,786</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26895744]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">26,895,744</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23983965]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">23,983,965</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6335]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">6,335</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2911779]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,911,779</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,21]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">21</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,8880]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">8,880</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3056]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,056</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,27137280]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">27,137,280</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,24146469]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">24,146,469</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,7901]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">7,901</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2990811]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,990,811</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,22]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">22</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,11104]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">11,104</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2376]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,376</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,26383104]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">26,383,104</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,23654235]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">23,654,235</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,9955]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">9,955</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2728869]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,728,869</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,23]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">23</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,13880]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">13,880</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,2297]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">2,297</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,31882360]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">31,882,360</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,28479830]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">28,479,830</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,12399]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">12,399</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,3402530]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">3,402,530</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,24]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">24</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,17352]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">17,352</td><td data-sheets-value="[null,3,null,616]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">616</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,10688832]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">10,688,832</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,8733548]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">8,733,548</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,14178]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">14,178</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,1955284]" style="padding: 0px 3px; text-align: right; vertical-align: bottom;">1,955,284</td></tr>
<tr style="height: 20px;"><td style="padding: 0px 3px; vertical-align: bottom;"></td><td style="padding: 0px 3px; vertical-align: bottom;"></td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,6473315]" style="font-weight: bold; padding: 0px 3px; text-align: right; vertical-align: bottom;">6,473,315</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5508217816]" style="font-weight: bold; padding: 0px 3px; text-align: right; vertical-align: bottom;">5,508,217,816</td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,5011363303]" style="font-weight: bold; padding: 0px 3px; text-align: right; vertical-align: bottom;">5,011,363,303</td><td style="padding: 0px 3px; vertical-align: bottom;"></td><td data-sheets-numberformat="[null,2,&quot;#,##0&quot;,1]" data-sheets-value="[null,3,null,496854513]" style="font-weight: bold; padding: 0px 3px; text-align: right; vertical-align: bottom;">496,854,513</td></tr>
</tbody></table>
<br />
As expected, the extra 8 bytes per slab has allowed a large number of items to be moved to slabs having smaller chunk sizes with more than half of the items in slab 11 now fitting into slab 10 and saving almost 600 MB of memory. The average item size being closer to the slab chunk size is another indicator that we are making more efficient use of the memory in each slab.<br />
<br />
For reference, the size of the items each slab can contain are below. The chunk sizes are displayed when running 'memcached -vv', reformatting this into a table and calculating the maximum item size gives:<br />
<br />
<table border="1" cellpadding="0" cellspacing="0" dir="ltr" style="border-collapse: collapse; border: 1px solid #ccc; font-family: Calibri; font-size: 13px; table-layout: fixed;"><colgroup><col width="31"></col><col width="69"></col><col width="62"></col><col width="61"></col></colgroup><tbody>
<tr style="height: 20px;"><td data-sheets-value="[null,2,&quot;Slab&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom;">Slab</td><td data-sheets-value="[null,2,&quot;Chunk size&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom;">Chunk size</td><td data-sheets-value="[null,2,&quot;Max data&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom;">Max data</td><td data-sheets-value="[null,2,&quot;Min Data&quot;]" style="font-weight: bold; padding: 0px 3px; vertical-align: bottom;">Min data</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,1]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1</td><td data-sheets-value="[null,3,null,96]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">96</td><td data-sheets-value="[null,3,null,30]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">30</td><td data-sheets-value="[null,3,null,1]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,2]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2</td><td data-sheets-value="[null,3,null,120]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">120</td><td data-sheets-value="[null,3,null,54]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">54</td><td data-sheets-value="[null,3,null,31]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">31</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,3]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3</td><td data-sheets-value="[null,3,null,152]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">152</td><td data-sheets-value="[null,3,null,86]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">86</td><td data-sheets-value="[null,3,null,55]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">55</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,4]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4</td><td data-sheets-value="[null,3,null,192]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">192</td><td data-sheets-value="[null,3,null,125]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">125</td><td data-sheets-value="[null,3,null,87]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">87</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,5]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5</td><td data-sheets-value="[null,3,null,240]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">240</td><td data-sheets-value="[null,3,null,173]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">173</td><td data-sheets-value="[null,3,null,126]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">126</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,6]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">6</td><td data-sheets-value="[null,3,null,304]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">304</td><td data-sheets-value="[null,3,null,237]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">237</td><td data-sheets-value="[null,3,null,174]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">174</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,7]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7</td><td data-sheets-value="[null,3,null,384]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">384</td><td data-sheets-value="[null,3,null,317]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">317</td><td data-sheets-value="[null,3,null,238]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">238</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,8]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">8</td><td data-sheets-value="[null,3,null,480]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">480</td><td data-sheets-value="[null,3,null,413]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">413</td><td data-sheets-value="[null,3,null,318]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">318</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,9]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">9</td><td data-sheets-value="[null,3,null,600]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">600</td><td data-sheets-value="[null,3,null,533]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">533</td><td data-sheets-value="[null,3,null,414]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">414</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,10]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">10</td><td data-sheets-value="[null,3,null,752]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">752</td><td data-sheets-value="[null,3,null,685]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">685</td><td data-sheets-value="[null,3,null,534]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">534</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,11]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11</td><td data-sheets-value="[null,3,null,944]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">944</td><td data-sheets-value="[null,3,null,877]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">877</td><td data-sheets-value="[null,3,null,686]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">686</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,12]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">12</td><td data-sheets-value="[null,3,null,1184]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1184</td><td data-sheets-value="[null,3,null,1116]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1116</td><td data-sheets-value="[null,3,null,878]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">878</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,13]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13</td><td data-sheets-value="[null,3,null,1480]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1480</td><td data-sheets-value="[null,3,null,1412]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1412</td><td data-sheets-value="[null,3,null,1117]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1117</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,14]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">14</td><td data-sheets-value="[null,3,null,1856]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1856</td><td data-sheets-value="[null,3,null,1788]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1788</td><td data-sheets-value="[null,3,null,1413]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1413</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,15]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">15</td><td data-sheets-value="[null,3,null,2320]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2320</td><td data-sheets-value="[null,3,null,2252]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2252</td><td data-sheets-value="[null,3,null,1789]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1789</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,16]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">16</td><td data-sheets-value="[null,3,null,2904]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2904</td><td data-sheets-value="[null,3,null,2836]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2836</td><td data-sheets-value="[null,3,null,2253]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2253</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,17]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">17</td><td data-sheets-value="[null,3,null,3632]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3632</td><td data-sheets-value="[null,3,null,3564]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3564</td><td data-sheets-value="[null,3,null,2837]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">2837</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,18]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">18</td><td data-sheets-value="[null,3,null,4544]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4544</td><td data-sheets-value="[null,3,null,4476]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4476</td><td data-sheets-value="[null,3,null,3565]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">3565</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,19]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">19</td><td data-sheets-value="[null,3,null,5680]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5680</td><td data-sheets-value="[null,3,null,5612]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5612</td><td data-sheets-value="[null,3,null,4477]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">4477</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,20]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">20</td><td data-sheets-value="[null,3,null,7104]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7104</td><td data-sheets-value="[null,3,null,7036]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7036</td><td data-sheets-value="[null,3,null,5613]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">5613</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,21]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">21</td><td data-sheets-value="[null,3,null,8880]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">8880</td><td data-sheets-value="[null,3,null,8812]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">8812</td><td data-sheets-value="[null,3,null,7037]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">7037</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,22]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">22</td><td data-sheets-value="[null,3,null,11104]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11104</td><td data-sheets-value="[null,3,null,11035]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11035</td><td data-sheets-value="[null,3,null,8813]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">8813</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,23]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">23</td><td data-sheets-value="[null,3,null,13880]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13880</td><td data-sheets-value="[null,3,null,13811]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13811</td><td data-sheets-value="[null,3,null,11036]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">11036</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,24]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">24</td><td data-sheets-value="[null,3,null,17352]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">17352</td><td data-sheets-value="[null,3,null,17283]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">17283</td><td data-sheets-value="[null,3,null,13812]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">13812</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,25]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">25</td><td data-sheets-value="[null,3,null,21696]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">21696</td><td data-sheets-value="[null,3,null,21627]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">21627</td><td data-sheets-value="[null,3,null,17284]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">17284</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,26]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">26</td><td data-sheets-value="[null,3,null,27120]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">27120</td><td data-sheets-value="[null,3,null,27051]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">27051</td><td data-sheets-value="[null,3,null,21628]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">21628</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,27]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">27</td><td data-sheets-value="[null,3,null,33904]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">33904</td><td data-sheets-value="[null,3,null,33835]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">33835</td><td data-sheets-value="[null,3,null,27052]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">27052</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,28]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">28</td><td data-sheets-value="[null,3,null,42384]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">42384</td><td data-sheets-value="[null,3,null,42315]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">42315</td><td data-sheets-value="[null,3,null,33836]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">33836</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,29]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">29</td><td data-sheets-value="[null,3,null,52984]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">52984</td><td data-sheets-value="[null,3,null,52915]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">52915</td><td data-sheets-value="[null,3,null,42316]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">42316</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,30]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">30</td><td data-sheets-value="[null,3,null,66232]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">66232</td><td data-sheets-value="[null,3,null,66163]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">66163</td><td data-sheets-value="[null,3,null,52916]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">52916</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,31]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">31</td><td data-sheets-value="[null,3,null,82792]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">82792</td><td data-sheets-value="[null,3,null,82723]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">82723</td><td data-sheets-value="[null,3,null,66164]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">66164</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,32]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">32</td><td data-sheets-value="[null,3,null,103496]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">103496</td><td data-sheets-value="[null,3,null,103426]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">103426</td><td data-sheets-value="[null,3,null,82724]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">82724</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,33]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">33</td><td data-sheets-value="[null,3,null,129376]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">129376</td><td data-sheets-value="[null,3,null,129306]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">129306</td><td data-sheets-value="[null,3,null,103427]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">103427</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,34]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">34</td><td data-sheets-value="[null,3,null,161720]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">161720</td><td data-sheets-value="[null,3,null,161650]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">161650</td><td data-sheets-value="[null,3,null,129307]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">129307</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,35]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">35</td><td data-sheets-value="[null,3,null,202152]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">202152</td><td data-sheets-value="[null,3,null,202082]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">202082</td><td data-sheets-value="[null,3,null,161651]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">161651</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,36]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">36</td><td data-sheets-value="[null,3,null,252696]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">252696</td><td data-sheets-value="[null,3,null,252626]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">252626</td><td data-sheets-value="[null,3,null,202083]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">202083</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,37]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">37</td><td data-sheets-value="[null,3,null,315872]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">315872</td><td data-sheets-value="[null,3,null,315802]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">315802</td><td data-sheets-value="[null,3,null,252627]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">252627</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,38]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">38</td><td data-sheets-value="[null,3,null,394840]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">394840</td><td data-sheets-value="[null,3,null,394770]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">394770</td><td data-sheets-value="[null,3,null,315803]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">315803</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,39]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">39</td><td data-sheets-value="[null,3,null,493552]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">493552</td><td data-sheets-value="[null,3,null,493482]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">493482</td><td data-sheets-value="[null,3,null,394771]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">394771</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,40]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">40</td><td data-sheets-value="[null,3,null,616944]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">616944</td><td data-sheets-value="[null,3,null,616874]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">616874</td><td data-sheets-value="[null,3,null,493483]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">493483</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,41]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">41</td><td data-sheets-value="[null,3,null,771184]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">771184</td><td data-sheets-value="[null,3,null,771114]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">771114</td><td data-sheets-value="[null,3,null,616875]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">616875</td></tr>
<tr style="height: 20px;"><td data-sheets-value="[null,3,null,42]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">42</td><td data-sheets-value="[null,3,null,1048576]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1048576</td><td data-sheets-value="[null,3,null,1048505]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">1048505</td><td data-sheets-value="[null,3,null,771115]" style="padding: 0px 3px 0px 3px; text-align: right; vertical-align: bottom;">771115</td></tr>
</tbody></table>
<br />
This table is using the default Memcached config settings (48 min item, 1.25 growth factor, cas enabled). The "Max data" column is the maximum number of bytes that can be used to store both the key and the value for an item in this slab. The "Min data" column is the minimum data size required for an item to be put in a slab and is simply the maximum data size from the previous slab&nbsp;+ 1. With CAS disabled the max and min data values would be increased by 8 bytes for all items with the exception of the minimum data for slab 1 remaining at 1 byte. The following Python function can be used for calculating the maximum item size (key + value)&nbsp;per slab:<br />
<br />
<br /></div>
<script src="https://gist.github.com/watchamcb/8625618560c94eafb3e7.js"></script>

<br />
<h4>
Conclusion</h4>
<div>
In this post we have had a look at the details of Memcached item overhead and identified disabling CAS as a simple mechanism of improving memory utilisation which will reduce evictions and increase hit rate. In the next post we will look at how adjusting the growth factor and minimum item size can further improve memory utilisation.</div>

  </div><a class="u-url" href="/2016/02/18/memcached-item-memory-usage.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Deplication</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Deplication</li><li><a class="u-email" href="mailto:craig@deplication.net">craig@deplication.net</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/watchamcb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">watchamcb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Simpler is better.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
